<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Daniel Brunner" />

<meta name="date" content="2019-12-11" />

<title>BLPestimatoR - Package for Demand Estimation</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">BLPestimatoR - Package for Demand Estimation</h1>
<h4 class="author">Daniel Brunner</h4>
<h4 class="date">2019-12-11</h4>



<div id="intro" class="section level1">
<h1>Intro</h1>
<p><code>BLPestimatoR</code> provides an efficient estimation algorithm to perform the demand estimation described in <span class="citation">Berry, Levinsohn, and Pakes (1995)</span>. The routine uses analytic gradients and offers a large number of optimization routines and implemented integration methods as discussed in <span class="citation">Brunner et al. (2017)</span>.</p>
<p>This extended documentation demonstrates the steps of a typical demand estimation with the package:</p>
<ul>
<li>prepare the data with <code>BLP_data</code> (includes the specification of a model and providing integration draws for observed or unobserved heterogeneity)</li>
<li>estimate the parameters with <code>estimate_BLP</code></li>
<li>showing the results with <code>summary</code></li>
<li>view the own- and crosspriceelasticities with <code>get_elasticities</code></li>
<li>perform a hypothetical merger analysis</li>
</ul>
<p>For this purpose the well-known training datasets for the cereal market <span class="citation">(Nevo 2001)</span> and the car market <span class="citation">(Berry, Levinsohn, and Pakes 1995)</span> are included in the package. Loading the package is therefore the very first step of the demand estimation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(BLPestimatoR)</a></code></pre></div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<div id="model" class="section level2">
<h2>Model</h2>
<p>Since version 0.1.6 the model is provided in R’s formula syntax and consists of five parts. The variable to be explained is given by observed market shares. Explanatory variables are grouped into four (possibly overlapping) categories separated by <code>|</code>:</p>
<ul>
<li>linear variables</li>
<li>exogenous variables</li>
<li>random coefficients</li>
<li>instruments</li>
</ul>
<p>The first part of this documentation starts with the cereal data example from <span class="citation">Nevo (2001)</span>. Nevo’s model can be translated into the following formula syntax:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">nevos_model &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="st">&quot;share ~  price + productdummy |</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="st">    0+ productdummy |</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">    price + sugar + mushy |</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">    0+ IV1 + IV2 + IV3 + IV4 + IV5 + IV6 + IV7 + IV8 + IV9 + IV10 + </span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">    IV11 + IV12 + IV13 + IV14 + IV15 + IV16 + IV17 + IV18 + IV19 + IV20&quot;</span>)</a></code></pre></div>
<p>The model is directly related to consumer <span class="math inline">\(i\)</span>’s indirect utility from purchasing cereal <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[u_{ijt}=\sum_{m=1}^M x^{(m)}_{jt} \beta_{i,m}+\xi_{jt}+\epsilon_{ijt} \;\; \text{with}\]</span> <span class="math display">\[\beta_{i,m}= \bar{\beta}_m  + \sum_{r=1}^R  \gamma_{m,r} d_{i,r}  +  \sigma_m \nu_{i,m}\]</span> and</p>
<ul>
<li>M = 4 random coefficients (<code>price</code>, <code>sugar</code>, <code>mushy</code> and an intercept)</li>
<li>R = 4 demographics (<code>income</code>, <code>incomesq</code>, <code>age</code>, <code>child</code>)</li>
<li>and the set of non-linear parameters to estimate:</li>
</ul>
<p><span class="math display">\[\theta_2 = 
\begin{pmatrix}
\sigma_1 &amp; \gamma_{1,1} &amp; \cdots &amp; \gamma_{1,R} \\
\sigma_2 &amp; \gamma_{2,1} &amp; \cdots &amp; \gamma_{2,R} \\
\vdots &amp; \vdots &amp;  \ddots &amp; \vdots \\
\sigma_M &amp; \gamma_{M,1} &amp; \cdots &amp; \gamma_{M,R}
\end{pmatrix}\]</span></p>
</div>
<div id="dataframe" class="section level2">
<h2>Dataframe</h2>
<p>Product related variables are collected in the dataframe <code>productData</code> with the following requirements:</p>
<ul>
<li>missings are not allowed</li>
<li>character variables are automatically transformed to a set of dummy variables</li>
<li>a variable that describes market affiliation (<code>market_identifier</code>)</li>
</ul>
<p>A variable that uniquely identifies a product in a market (<code>product_identifier</code>) is optional, but enhances clarity (interpreting elasticities, for example, is much easier). <code>market_identifier</code> and <code>product_identifier</code> together uniquely identify an observation, which is used by the function <code>update_BLP_data</code> to update any variable in the data (in this case <code>product_identifier</code> is mandatory).</p>
<p>In the cereal example, this gives the following dataframe:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">head</span>(productData_cereal)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;        price const sugar mushy       share     cdid        IV1        IV2</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; 1 0.07208794     1     2     1 0.012417212 market_1 -0.2159728 0.04057341</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; 2 0.11417849     1    18     1 0.007809387 market_1 -0.2452393 0.05474226</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; 3 0.13239066     1     4     1 0.012994511 market_1 -0.1764587 0.04659597</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; 4 0.13034408     1     3     0 0.005769961 market_1 -0.1214013 0.04876037</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; 5 0.15482331     1    12     0 0.017934141 market_1 -0.1326114 0.03962835</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 6 0.13704921     1    14     0 0.026601892 market_1 -0.1534998 0.04298842</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;          IV3          IV4         IV5           IV6        IV7         IV8</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 1  -3.247948 -0.523937695 -0.23246005  0.0068326605  3.1397395 -0.57478633</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt; 2 -19.832461 -0.180519694  0.01468859  0.0007988026  0.2876539  0.03293960</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 3  -2.878531 -0.284219004 -0.21553691 -0.0318693281  2.8862741 -0.74976495</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 4  -2.059918 -0.328412257 -0.22206995 -0.0314740402  4.4531096  0.25567529</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; 5  -6.137598 -0.138625095 -0.18936521 -0.0437471023 -3.5546508  0.13882114</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; 6  -8.417332  0.007829087 -0.13850121 -0.0210582272 -2.7594799  0.05020052</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt;          IV9       IV10       IV11        IV12          IV13       IV14</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; 1  0.2062202  0.1774656  2.1163580 -0.15470824 -0.0057964065 0.01453802</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt; 2  0.1051208 -0.2875618 -7.3740909 -0.57641176  0.0129908544 0.07614324</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; 3 -0.4789565  0.2147389  2.1878721 -0.20734643  0.0035092777 0.09178117</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; 4 -0.4729673  0.3560980  2.7045762  0.04074801 -0.0037242656 0.09473168</span></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="co">#&gt; 5 -0.6886784  0.2602726  1.2612419  0.03483558 -0.0005676374 0.10245147</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="co">#&gt; 6 -0.2734440  0.1273060  0.3375543  0.02351037  0.0002637777 0.08627983</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="co">#&gt;         IV15       IV16       IV17       IV18       IV19       IV20</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="co">#&gt; 1 0.12624398 0.06734464 0.06842261 0.03480046 0.12634612 0.03548368</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="co">#&gt; 2 0.02973565 0.08786672 0.11050060 0.08778380 0.04987192 0.07257905</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"><span class="co">#&gt; 3 0.16377308 0.11188073 0.10822551 0.08643905 0.12234707 0.10184248</span></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="co">#&gt; 4 0.13527378 0.08809001 0.10176745 0.10177748 0.11074119 0.10433204</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="co">#&gt; 5 0.13063951 0.08481820 0.10107461 0.12516923 0.13346381 0.12111110</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="co">#&gt; 6 0.07233581 0.02225051 0.10564387 0.11603699 0.09965063 0.10572660</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="co">#&gt;   product_id productdummy</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="co">#&gt; 1   cereal_1     product1</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="co">#&gt; 2   cereal_2     product2</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="co">#&gt; 3   cereal_3     product3</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="co">#&gt; 4   cereal_4     product4</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="co">#&gt; 5   cereal_5     product5</span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="co">#&gt; 6   cereal_6     product6</span></a></code></pre></div>
</div>
<div id="integration-draws" class="section level2">
<h2>Integration Draws</h2>
<p>The arguments related to the numerical integration problem are of particular importance when providing own integration draws and weights, which is most relevant for observed heterogeneity (for unobserved heterogeneity, the straightforward approach is the use of automatic integration).</p>
<p>In the cereal data, both, observed and unobserved heterogeneity, is used for the random coefficients. Starting with observed heterogeneity, user provided draws are collected in a list. Each list entry must be named according to the name of a demographic. Each entry contains the following variables:</p>
<ul>
<li>a variable <code>market_identifier</code> that matches each line to a market (same variable name as in <code>productData</code>)</li>
<li>integration draws for each market</li>
</ul>
<p>In the cereal example, observed heterogeneity is provided as follows (list names correspond to the demographics):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">demographicData_cereal<span class="op">$</span>income[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt;       cdid     draw_1     draw_2     draw_3      draw_4</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; 1 market_1 0.49512349  0.3787622  0.1050146 -1.48548093</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; 2 market_2 0.05389113 -1.5030833  0.6217917  0.26922901</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; 3 market_3 0.62459788 -0.2242698 -0.2846169  0.67845943</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; 4 market_4 0.94419851  0.4056359  0.5859923  0.01813051</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8">demographicData_cereal<span class="op">$</span>incomesq[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;       cdid     draw_1     draw_2    draw_3      draw_4</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 1 market_1  8.3313042   6.121865  1.030803 -25.5836047</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 2 market_2  0.0966346 -25.849845 10.767233   4.0668173</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; 3 market_3 10.8215619  -4.894545 -5.956954  11.8673879</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; 4 market_4 17.1121550   6.629730 10.075529  -0.5537043</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"></a>
<a class="sourceLine" id="cb4-15" data-line-number="15">demographicData_cereal<span class="op">$</span>age[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;       cdid     draw_1     draw_2       draw_3     draw_4</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; 1 market_1 -0.2301090 -2.5326941 -0.006965458 -0.8279460</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; 2 market_2  0.1414545 -0.1813188 -1.279931134 -0.4532526</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; 3 market_3 -0.1813188 -0.5867840  0.208145922 -0.4532526</span></a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="co">#&gt; 4 market_4  0.7444506  0.1414545  0.645359728  0.8346017</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">demographicData_cereal<span class="op">$</span>child[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#&gt;       cdid     draw_1     draw_2     draw_3     draw_4</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#&gt; 1 market_1 -0.2308511  0.7691489 -0.2308511  0.7691489</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co">#&gt; 2 market_2 -0.2308511 -0.2308511  0.7691489 -0.2308511</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26"><span class="co">#&gt; 3 market_3 -0.2308511  0.7691489 -0.2308511 -0.2308511</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"><span class="co">#&gt; 4 market_4 -0.2308511 -0.2308511 -0.2308511 -0.2308511</span></a></code></pre></div>
<p>If demographic input (<code>demographicData</code>) is missing, the estimation routine considers only coefficients for unobserved heterogeneity. This can be done by already implemented integration methods via <code>integration_method</code> as shown in the estimation section. In Nevo’s cereal example however, a specific set of 20 draws is given. For this situation, draws are also provided as a list (list names correspond to the formula’s random coefficients and each list entry has a variable <code>market_identifier</code>):</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">originalDraws_cereal<span class="op">$</span>constant[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt;       cdid       draw_1     draw_2     draw_3      draw_4</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt; 1 market_1  0.434100553 -0.7266491 -0.6230607 -0.04131699</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; 2 market_2  0.001702598  0.2228245 -1.0287201  0.38312476</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 3 market_3 -0.529569305  0.7248712  0.2910167 -1.39164253</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; 4 market_4  0.019233489 -1.4250308 -0.2678170 -2.26541236</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># renaming constants:</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="kw">names</span>(originalDraws_cereal)[<span class="dv">1</span>] &lt;-<span class="st"> &quot;(Intercept)&quot;</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">originalDraws_cereal<span class="op">$</span>price[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="co">#&gt;       cdid     draw_1     draw_2     draw_3     draw_4</span></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co">#&gt; 1 market_1 -1.5008378  0.1331817 -0.1382405  1.2571357</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#&gt; 2 market_2  0.0276477 -0.8414414 -0.9056861 -2.0306179</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt; 3 market_3 -0.4768085 -0.9348689  1.4300456  2.6188581</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 4 market_4  0.5396019  0.1698178  0.7128376 -0.1216309</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"></a>
<a class="sourceLine" id="cb5-18" data-line-number="18">originalDraws_cereal<span class="op">$</span>sugar[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt;       cdid     draw_1     draw_2     draw_3     draw_4</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; 1 market_1 -1.1510786 -0.5007498  0.7974412 -0.6830540</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; 2 market_2  1.0451218  1.0170277  2.3012550  0.1490338</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22"><span class="co">#&gt; 3 market_3 -1.0187809  0.3107185 -0.9531532  0.8057080</span></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt; 4 market_4 -0.5760582 -0.5072059 -0.7496653  1.1163544</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"></a>
<a class="sourceLine" id="cb5-25" data-line-number="25">originalDraws_cereal<span class="op">$</span>mushy[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="co">#&gt;       cdid     draw_1     draw_2      draw_3     draw_4</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="co">#&gt; 1 market_1 0.16101681  0.1297316 -0.79554915  0.2590437</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="co">#&gt; 2 market_2 0.23595798  0.1345995  0.07284586  0.9509871</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="co">#&gt; 3 market_3 0.02922435 -0.1704289  0.36395246  0.4879702</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="co">#&gt; 4 market_4 1.27701102  0.4284194  0.46124654 -1.0110437</span></a></code></pre></div>
<p>As demonstrated above, list entries for draws of constants <strong>must</strong> be named <code>(Intercept)</code>. Other names of list entries must match the random coefficients specified in the formula.</p>
</div>
<div id="calling-blp_data" class="section level2">
<h2>Calling BLP_data</h2>
<p>Calling <code>BLP_data</code> structures and prepares the data for estimation and creates the data object:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">productData_cereal<span class="op">$</span>startingGuessesDelta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">log</span>(w_guesses_cereal)) <span class="co"># include orig. draws in the product data</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">cereal_data &lt;-<span class="st"> </span><span class="kw">BLP_data</span>(</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">model =</span> nevos_model,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">market_identifier =</span> <span class="st">&quot;cdid&quot;</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="dt">par_delta =</span> <span class="st">&quot;startingGuessesDelta&quot;</span>,</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="dt">product_identifier =</span> <span class="st">&quot;product_id&quot;</span>,</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  <span class="dt">productData =</span> productData_cereal,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  <span class="dt">demographic_draws =</span> demographicData_cereal,</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  <span class="dt">blp_inner_tol =</span> <span class="fl">1e-6</span>, <span class="dt">blp_inner_maxit =</span> <span class="dv">5000</span>,</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  <span class="dt">integration_draws =</span> originalDraws_cereal,</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">  <span class="dt">integration_weights =</span> <span class="kw">rep</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">20</span>, <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb6-13" data-line-number="13">)</a></code></pre></div>
<p>The arguments in greater detail:</p>
<ul>
<li><p><code>model</code> provides the utility model as explained above</p></li>
<li><p><code>market_identifier</code> gives the name of the variable in <code>productData</code> that matches each observation to a market</p></li>
<li><p><code>product_identifier</code> gives the name of the variable in <code>productData</code> that matches each observation to a product (must be unique in a market)</p></li>
<li><p><code>productData</code> is given as a dataframe and <code>demographicData</code> as a list as described above</p></li>
<li><p><code>par_delta</code> gives the name of the variable in <code>productData</code> for mean utilities</p></li>
<li><p><code>blp_inner_tol</code> , <code>blp_inner_maxit</code>: arguments related to be BLP algorithm include the convergence threshold and the maximum number of iterations in the contraction mapping</p></li>
<li><p>if integration draws are provided manually, <code>integration_draws</code> and <code>integration_weights</code> need to be specified</p></li>
<li><p>for automatic integration the user specifies <code>integration_method</code>, for example <code>integration_method= &quot;MLHS&quot;</code>, and the accuracy of the integration method by <code>integration_accuracy</code> (for stochastic integration methods this equals the number of draws)</p></li>
</ul>
<p>If you decide to update your data later, you can use the function <code>update_BLP_data</code>.</p>
</div>
</div>
<div id="estimation" class="section level1">
<h1>Estimation</h1>
<div id="starting-guesses" class="section level2">
<h2>Starting guesses</h2>
<p>The provided set of starting guesses <code>par_theta2</code> is matched with formula input and demographic data:</p>
<ul>
<li>rownames of <code>par_theta2</code> must match with the random coefficients specified in the formula (note: constants <strong>must</strong> be named <code>(Intercept)</code> )</li>
<li>colnames of <code>par_theta2</code> must match with list entry names of <code>demographicData</code> and a column for unobserved heterogeneity (<strong>must</strong> be named `unobs_sd)</li>
<li><code>NA</code>s in <code>par_theta2</code> indicate the exclusion from estimation, i.e. the coefficient is assumed to be zero.</li>
</ul>
<p>These requirements are demonstrated with a set of exemplary starting guesses:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># before:</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">theta_guesses_cereal</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;        [,1]    [,2] [,3]    [,4]   [,5]</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; [1,] 0.3302  5.4819  0.0  0.2037 0.0000</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt; [2,] 2.4526 15.8935 -1.2  0.0000 2.6342</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; [3,] 0.0163 -0.2506  0.0  0.0511 0.0000</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt; [4,] 0.2441  1.2650  0.0 -0.8091 0.0000</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">theta_guesses_cereal[theta_guesses_cereal <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="kw">colnames</span>(theta_guesses_cereal) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unobs_sd&quot;</span>, <span class="st">&quot;income&quot;</span>, <span class="st">&quot;incomesq&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;child&quot;</span>)</a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="kw">rownames</span>(theta_guesses_cereal) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;price&quot;</span>, <span class="st">&quot;sugar&quot;</span>, <span class="st">&quot;mushy&quot;</span>)</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co"># correctly named:</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">theta_guesses_cereal</a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;             unobs_sd  income incomesq     age  child</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; (Intercept)   0.3302  5.4819       NA  0.2037     NA</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt; price         2.4526 15.8935     -1.2      NA 2.6342</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; sugar         0.0163 -0.2506       NA  0.0511     NA</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; mushy         0.2441  1.2650       NA -0.8091     NA</span></a></code></pre></div>
</div>
<div id="calling-estimateblp" class="section level2">
<h2>Calling estimateBLP</h2>
<p>The following code performs the demand estimation:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">cereal_est &lt;-<span class="st"> </span><span class="kw">estimateBLP</span>(</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">  <span class="dt">solver_method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="dt">solver_maxit =</span> <span class="dv">1000</span>, <span class="dt">solver_reltol =</span> <span class="fl">1e-6</span>,</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="dt">standardError =</span> <span class="st">&quot;heteroskedastic&quot;</span>,</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="dt">extremumCheck =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="dt">printLevel =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="co">#&gt; blp_data were prepared with the following arguments:</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; BLP_data(model = nevos_model, market_identifier = &quot;cdid&quot;, product_identifier = &quot;product_id&quot;, </span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt;     par_delta = &quot;startingGuessesDelta&quot;, productData = productData_cereal, </span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="co">#&gt;     demographic_draws = demographicData_cereal, integration_draws = originalDraws_cereal, </span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="co">#&gt;     integration_weights = rep(1/20, 20), blp_inner_tol = 1e-06, </span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;     blp_inner_maxit = 5000)</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; Starting a BLP demand estimation with  2256  observations in  94  markets...</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; [integration::method  integration::amountDraws 20 ]</span></a>
<a class="sourceLine" id="cb8-17" data-line-number="17"><span class="co">#&gt; [blp::inner_tol 1e-06  blp::inner_maxit 5000 ]</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18"><span class="co">#&gt; [solver::method BFGS  solver::maxit 1000  solver::reltol 1e-06 ]</span></a>
<a class="sourceLine" id="cb8-19" data-line-number="19"><span class="co">#&gt; gmm objective: 29.3522</span></a>
<a class="sourceLine" id="cb8-20" data-line-number="20"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-23" data-line-number="23"><span class="co">#&gt; gmm objective: 22451.18</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24"><span class="co">#&gt; gmm objective: 775.9515</span></a>
<a class="sourceLine" id="cb8-25" data-line-number="25"><span class="co">#&gt; gmm objective: 71.6209</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26"><span class="co">#&gt; gmm objective: 26.8851</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-28" data-line-number="28"><span class="co">#&gt; gmm objective: 330914</span></a>
<a class="sourceLine" id="cb8-29" data-line-number="29"><span class="co">#&gt; gmm objective: 12694.84</span></a>
<a class="sourceLine" id="cb8-30" data-line-number="30"><span class="co">#&gt; gmm objective: 311.8842</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31"><span class="co">#&gt; gmm objective: 38.2627</span></a>
<a class="sourceLine" id="cb8-32" data-line-number="32"><span class="co">#&gt; gmm objective: 26.9935</span></a>
<a class="sourceLine" id="cb8-33" data-line-number="33"><span class="co">#&gt; gmm objective: 26.8196</span></a>
<a class="sourceLine" id="cb8-34" data-line-number="34"><span class="co">#&gt; gmm objective: 40772.63</span></a>
<a class="sourceLine" id="cb8-35" data-line-number="35"><span class="co">#&gt; gmm objective: 1186.144</span></a>
<a class="sourceLine" id="cb8-36" data-line-number="36"><span class="co">#&gt; gmm objective: 103.4133</span></a>
<a class="sourceLine" id="cb8-37" data-line-number="37"><span class="co">#&gt; gmm objective: 27.9556</span></a>
<a class="sourceLine" id="cb8-38" data-line-number="38"><span class="co">#&gt; gmm objective: 26.1524</span></a>
<a class="sourceLine" id="cb8-39" data-line-number="39"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-40" data-line-number="40"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-41" data-line-number="41"><span class="co">#&gt; gmm objective: 28234.6</span></a>
<a class="sourceLine" id="cb8-42" data-line-number="42"><span class="co">#&gt; gmm objective: 756.8709</span></a>
<a class="sourceLine" id="cb8-43" data-line-number="43"><span class="co">#&gt; gmm objective: 37.7704</span></a>
<a class="sourceLine" id="cb8-44" data-line-number="44"><span class="co">#&gt; gmm objective: 24.7211</span></a>
<a class="sourceLine" id="cb8-45" data-line-number="45"><span class="co">#&gt; gmm objective: 5772.739</span></a>
<a class="sourceLine" id="cb8-46" data-line-number="46"><span class="co">#&gt; gmm objective: 202.5456</span></a>
<a class="sourceLine" id="cb8-47" data-line-number="47"><span class="co">#&gt; gmm objective: 27.2616</span></a>
<a class="sourceLine" id="cb8-48" data-line-number="48"><span class="co">#&gt; gmm objective: 23.9898</span></a>
<a class="sourceLine" id="cb8-49" data-line-number="49"><span class="co">#&gt; gmm objective: 838.469</span></a>
<a class="sourceLine" id="cb8-50" data-line-number="50"><span class="co">#&gt; gmm objective: 32.1783</span></a>
<a class="sourceLine" id="cb8-51" data-line-number="51"><span class="co">#&gt; gmm objective: 21.9662</span></a>
<a class="sourceLine" id="cb8-52" data-line-number="52"><span class="co">#&gt; gmm objective: 23912.56</span></a>
<a class="sourceLine" id="cb8-53" data-line-number="53"><span class="co">#&gt; gmm objective: 244.3514</span></a>
<a class="sourceLine" id="cb8-54" data-line-number="54"><span class="co">#&gt; gmm objective: 20.9664</span></a>
<a class="sourceLine" id="cb8-55" data-line-number="55"><span class="co">#&gt; gmm objective: 1417.216</span></a>
<a class="sourceLine" id="cb8-56" data-line-number="56"><span class="co">#&gt; gmm objective: 56.3625</span></a>
<a class="sourceLine" id="cb8-57" data-line-number="57"><span class="co">#&gt; gmm objective: 21.2928</span></a>
<a class="sourceLine" id="cb8-58" data-line-number="58"><span class="co">#&gt; gmm objective: 20.6459</span></a>
<a class="sourceLine" id="cb8-59" data-line-number="59"><span class="co">#&gt; gmm objective: 24.7031</span></a>
<a class="sourceLine" id="cb8-60" data-line-number="60"><span class="co">#&gt; gmm objective: 19.3915</span></a>
<a class="sourceLine" id="cb8-61" data-line-number="61"><span class="co">#&gt; gmm objective: 192.3949</span></a>
<a class="sourceLine" id="cb8-62" data-line-number="62"><span class="co">#&gt; gmm objective: 18.8625</span></a>
<a class="sourceLine" id="cb8-63" data-line-number="63"><span class="co">#&gt; gmm objective: 20.5334</span></a>
<a class="sourceLine" id="cb8-64" data-line-number="64"><span class="co">#&gt; gmm objective: 17.7234</span></a>
<a class="sourceLine" id="cb8-65" data-line-number="65"><span class="co">#&gt; gmm objective: 16.7846</span></a>
<a class="sourceLine" id="cb8-66" data-line-number="66"><span class="co">#&gt; gmm objective: 16.4664</span></a>
<a class="sourceLine" id="cb8-67" data-line-number="67"><span class="co">#&gt; gmm objective: 15.9588</span></a>
<a class="sourceLine" id="cb8-68" data-line-number="68"><span class="co">#&gt; gmm objective: 15.0231</span></a>
<a class="sourceLine" id="cb8-69" data-line-number="69"><span class="co">#&gt; gmm objective: 14.9101</span></a>
<a class="sourceLine" id="cb8-70" data-line-number="70"><span class="co">#&gt; gmm objective: 14.8987</span></a>
<a class="sourceLine" id="cb8-71" data-line-number="71"><span class="co">#&gt; gmm objective: 14.8961</span></a>
<a class="sourceLine" id="cb8-72" data-line-number="72"><span class="co">#&gt; gmm objective: 14.8902</span></a>
<a class="sourceLine" id="cb8-73" data-line-number="73"><span class="co">#&gt; gmm objective: 14.8788</span></a>
<a class="sourceLine" id="cb8-74" data-line-number="74"><span class="co">#&gt; gmm objective: 14.8479</span></a>
<a class="sourceLine" id="cb8-75" data-line-number="75"><span class="co">#&gt; gmm objective: 14.7731</span></a>
<a class="sourceLine" id="cb8-76" data-line-number="76"><span class="co">#&gt; gmm objective: 14.5807</span></a>
<a class="sourceLine" id="cb8-77" data-line-number="77"><span class="co">#&gt; gmm objective: 14.0873</span></a>
<a class="sourceLine" id="cb8-78" data-line-number="78"><span class="co">#&gt; gmm objective: 12.8012</span></a>
<a class="sourceLine" id="cb8-79" data-line-number="79"><span class="co">#&gt; gmm objective: 11.9828</span></a>
<a class="sourceLine" id="cb8-80" data-line-number="80"><span class="co">#&gt; gmm objective: 9.4672</span></a>
<a class="sourceLine" id="cb8-81" data-line-number="81"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-82" data-line-number="82"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-83" data-line-number="83"><span class="co">#&gt; gmm objective: 150504.2</span></a>
<a class="sourceLine" id="cb8-84" data-line-number="84"><span class="co">#&gt; gmm objective: 6437.658</span></a>
<a class="sourceLine" id="cb8-85" data-line-number="85"><span class="co">#&gt; gmm objective: 224.7393</span></a>
<a class="sourceLine" id="cb8-86" data-line-number="86"><span class="co">#&gt; gmm objective: 13.0643</span></a>
<a class="sourceLine" id="cb8-87" data-line-number="87"><span class="co">#&gt; gmm objective: 9.2023</span></a>
<a class="sourceLine" id="cb8-88" data-line-number="88"><span class="co">#&gt; gmm objective: Inf [delta contains NaN's] </span></a>
<a class="sourceLine" id="cb8-89" data-line-number="89"><span class="co">#&gt; gmm objective: 10140.17</span></a>
<a class="sourceLine" id="cb8-90" data-line-number="90"><span class="co">#&gt; gmm objective: 554.5767</span></a>
<a class="sourceLine" id="cb8-91" data-line-number="91"><span class="co">#&gt; gmm objective: 34.6091</span></a>
<a class="sourceLine" id="cb8-92" data-line-number="92"><span class="co">#&gt; gmm objective: 10.0322</span></a>
<a class="sourceLine" id="cb8-93" data-line-number="93"><span class="co">#&gt; gmm objective: 9.1844</span></a>
<a class="sourceLine" id="cb8-94" data-line-number="94"><span class="co">#&gt; gmm objective: 75730.14</span></a>
<a class="sourceLine" id="cb8-95" data-line-number="95"><span class="co">#&gt; gmm objective: 2145.751</span></a>
<a class="sourceLine" id="cb8-96" data-line-number="96"><span class="co">#&gt; gmm objective: 45.6103</span></a>
<a class="sourceLine" id="cb8-97" data-line-number="97"><span class="co">#&gt; gmm objective: 9.9089</span></a>
<a class="sourceLine" id="cb8-98" data-line-number="98"><span class="co">#&gt; gmm objective: 9.0889</span></a>
<a class="sourceLine" id="cb8-99" data-line-number="99"><span class="co">#&gt; gmm objective: 111102.8</span></a>
<a class="sourceLine" id="cb8-100" data-line-number="100"><span class="co">#&gt; gmm objective: 15512.82</span></a>
<a class="sourceLine" id="cb8-101" data-line-number="101"><span class="co">#&gt; gmm objective: 389.1241</span></a>
<a class="sourceLine" id="cb8-102" data-line-number="102"><span class="co">#&gt; gmm objective: 20.1367</span></a>
<a class="sourceLine" id="cb8-103" data-line-number="103"><span class="co">#&gt; gmm objective: 8.7624</span></a>
<a class="sourceLine" id="cb8-104" data-line-number="104"><span class="co">#&gt; gmm objective: 766.0638</span></a>
<a class="sourceLine" id="cb8-105" data-line-number="105"><span class="co">#&gt; gmm objective: 49.5382</span></a>
<a class="sourceLine" id="cb8-106" data-line-number="106"><span class="co">#&gt; gmm objective: 10.0242</span></a>
<a class="sourceLine" id="cb8-107" data-line-number="107"><span class="co">#&gt; gmm objective: 8.6598</span></a>
<a class="sourceLine" id="cb8-108" data-line-number="108"><span class="co">#&gt; gmm objective: 155.1232</span></a>
<a class="sourceLine" id="cb8-109" data-line-number="109"><span class="co">#&gt; gmm objective: 12.3475</span></a>
<a class="sourceLine" id="cb8-110" data-line-number="110"><span class="co">#&gt; gmm objective: 8.5964</span></a>
<a class="sourceLine" id="cb8-111" data-line-number="111"><span class="co">#&gt; gmm objective: 308.36</span></a>
<a class="sourceLine" id="cb8-112" data-line-number="112"><span class="co">#&gt; gmm objective: 10.1499</span></a>
<a class="sourceLine" id="cb8-113" data-line-number="113"><span class="co">#&gt; gmm objective: 8.3448</span></a>
<a class="sourceLine" id="cb8-114" data-line-number="114"><span class="co">#&gt; gmm objective: 1593.047</span></a>
<a class="sourceLine" id="cb8-115" data-line-number="115"><span class="co">#&gt; gmm objective: 18.5902</span></a>
<a class="sourceLine" id="cb8-116" data-line-number="116"><span class="co">#&gt; gmm objective: 7.9521</span></a>
<a class="sourceLine" id="cb8-117" data-line-number="117"><span class="co">#&gt; gmm objective: 24.6953</span></a>
<a class="sourceLine" id="cb8-118" data-line-number="118"><span class="co">#&gt; gmm objective: 7.4967</span></a>
<a class="sourceLine" id="cb8-119" data-line-number="119"><span class="co">#&gt; gmm objective: 7.8465</span></a>
<a class="sourceLine" id="cb8-120" data-line-number="120"><span class="co">#&gt; gmm objective: 7.4219</span></a>
<a class="sourceLine" id="cb8-121" data-line-number="121"><span class="co">#&gt; gmm objective: 7.3411</span></a>
<a class="sourceLine" id="cb8-122" data-line-number="122"><span class="co">#&gt; gmm objective: 7.2325</span></a>
<a class="sourceLine" id="cb8-123" data-line-number="123"><span class="co">#&gt; gmm objective: 7.0497</span></a>
<a class="sourceLine" id="cb8-124" data-line-number="124"><span class="co">#&gt; gmm objective: 6.9818</span></a>
<a class="sourceLine" id="cb8-125" data-line-number="125"><span class="co">#&gt; gmm objective: 6.9711</span></a>
<a class="sourceLine" id="cb8-126" data-line-number="126"><span class="co">#&gt; gmm objective: 6.9695</span></a>
<a class="sourceLine" id="cb8-127" data-line-number="127"><span class="co">#&gt; gmm objective: 6.9696</span></a>
<a class="sourceLine" id="cb8-128" data-line-number="128"><span class="co">#&gt; gmm objective: 6.9692</span></a>
<a class="sourceLine" id="cb8-129" data-line-number="129"><span class="co">#&gt; gmm objective: 6.9633</span></a>
<a class="sourceLine" id="cb8-130" data-line-number="130"><span class="co">#&gt; gmm objective: 6.9462</span></a>
<a class="sourceLine" id="cb8-131" data-line-number="131"><span class="co">#&gt; gmm objective: 6.8986</span></a>
<a class="sourceLine" id="cb8-132" data-line-number="132"><span class="co">#&gt; gmm objective: 6.8301</span></a>
<a class="sourceLine" id="cb8-133" data-line-number="133"><span class="co">#&gt; gmm objective: 6.6517</span></a>
<a class="sourceLine" id="cb8-134" data-line-number="134"><span class="co">#&gt; gmm objective: 6.3046</span></a>
<a class="sourceLine" id="cb8-135" data-line-number="135"><span class="co">#&gt; gmm objective: 5.7187</span></a>
<a class="sourceLine" id="cb8-136" data-line-number="136"><span class="co">#&gt; gmm objective: 5.0274</span></a>
<a class="sourceLine" id="cb8-137" data-line-number="137"><span class="co">#&gt; gmm objective: 4.6491</span></a>
<a class="sourceLine" id="cb8-138" data-line-number="138"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-139" data-line-number="139"><span class="co">#&gt; gmm objective: 54557.62</span></a>
<a class="sourceLine" id="cb8-140" data-line-number="140"><span class="co">#&gt; gmm objective: 2335.286</span></a>
<a class="sourceLine" id="cb8-141" data-line-number="141"><span class="co">#&gt; gmm objective: 90.1735</span></a>
<a class="sourceLine" id="cb8-142" data-line-number="142"><span class="co">#&gt; gmm objective: 7.3992</span></a>
<a class="sourceLine" id="cb8-143" data-line-number="143"><span class="co">#&gt; gmm objective: 4.667</span></a>
<a class="sourceLine" id="cb8-144" data-line-number="144"><span class="co">#&gt; gmm objective: 4.576</span></a>
<a class="sourceLine" id="cb8-145" data-line-number="145"><span class="co">#&gt; gmm objective: 4.575</span></a>
<a class="sourceLine" id="cb8-146" data-line-number="146"><span class="co">#&gt; gmm objective: 14656.41</span></a>
<a class="sourceLine" id="cb8-147" data-line-number="147"><span class="co">#&gt; gmm objective: 601.8347</span></a>
<a class="sourceLine" id="cb8-148" data-line-number="148"><span class="co">#&gt; gmm objective: 32.5354</span></a>
<a class="sourceLine" id="cb8-149" data-line-number="149"><span class="co">#&gt; gmm objective: 5.863</span></a>
<a class="sourceLine" id="cb8-150" data-line-number="150"><span class="co">#&gt; gmm objective: 4.6245</span></a>
<a class="sourceLine" id="cb8-151" data-line-number="151"><span class="co">#&gt; gmm objective: 4.5771</span></a>
<a class="sourceLine" id="cb8-152" data-line-number="152"><span class="co">#&gt; gmm objective: 4.5758</span></a>
<a class="sourceLine" id="cb8-153" data-line-number="153"><span class="co">#&gt; gmm objective: 4.5759</span></a>
<a class="sourceLine" id="cb8-154" data-line-number="154"><span class="co">#&gt; gmm objective: 4.5757</span></a>
<a class="sourceLine" id="cb8-155" data-line-number="155"><span class="co">#&gt; gmm objective: 4.5755</span></a>
<a class="sourceLine" id="cb8-156" data-line-number="156"><span class="co">#&gt; gmm objective: 4.5754</span></a>
<a class="sourceLine" id="cb8-157" data-line-number="157"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-158" data-line-number="158"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-159" data-line-number="159"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-160" data-line-number="160"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-161" data-line-number="161"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-162" data-line-number="162"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-163" data-line-number="163"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-164" data-line-number="164"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-165" data-line-number="165"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-166" data-line-number="166"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-167" data-line-number="167"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-168" data-line-number="168"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-169" data-line-number="169"><span class="co">#&gt; gmm objective: 16969.25</span></a>
<a class="sourceLine" id="cb8-170" data-line-number="170"><span class="co">#&gt; gmm objective: 603.3225</span></a>
<a class="sourceLine" id="cb8-171" data-line-number="171"><span class="co">#&gt; gmm objective: 23.8438</span></a>
<a class="sourceLine" id="cb8-172" data-line-number="172"><span class="co">#&gt; gmm objective: 5.2753</span></a>
<a class="sourceLine" id="cb8-173" data-line-number="173"><span class="co">#&gt; gmm objective: 4.5966</span></a>
<a class="sourceLine" id="cb8-174" data-line-number="174"><span class="co">#&gt; gmm objective: 4.575</span></a>
<a class="sourceLine" id="cb8-175" data-line-number="175"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-176" data-line-number="176"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-177" data-line-number="177"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-178" data-line-number="178"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-179" data-line-number="179"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-180" data-line-number="180"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-181" data-line-number="181"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-182" data-line-number="182"><span class="co">#&gt; gmm objective: 4.5753</span></a>
<a class="sourceLine" id="cb8-183" data-line-number="183"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-184" data-line-number="184"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-185" data-line-number="185"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-186" data-line-number="186"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-187" data-line-number="187"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-188" data-line-number="188"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-189" data-line-number="189"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-190" data-line-number="190"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-191" data-line-number="191"><span class="co">#&gt; gmm objective: 4.5752</span></a>
<a class="sourceLine" id="cb8-192" data-line-number="192"><span class="co">#&gt; ------------------------------------------ </span></a>
<a class="sourceLine" id="cb8-193" data-line-number="193"><span class="co">#&gt; Solver message: Successful convergence </span></a>
<a class="sourceLine" id="cb8-194" data-line-number="194"><span class="co">#&gt; ------------------------------------------ </span></a>
<a class="sourceLine" id="cb8-195" data-line-number="195"><span class="co">#&gt; Final GMM evaluation at optimal parameters: </span></a>
<a class="sourceLine" id="cb8-196" data-line-number="196"><span class="co">#&gt; gmm objective: 4.5744</span></a>
<a class="sourceLine" id="cb8-197" data-line-number="197"><span class="co">#&gt;   theta (RC): 0.55 3.29 -0.01 0.09 </span></a>
<a class="sourceLine" id="cb8-198" data-line-number="198"><span class="co">#&gt;   theta (demogr.): 2.3 577.44 -0.38 0.83 0 -29.63 0 0 1.27 0 0.05 -1.35 0 11.03 0 0 </span></a>
<a class="sourceLine" id="cb8-199" data-line-number="199"><span class="co">#&gt;   inner iterations: 70 </span></a>
<a class="sourceLine" id="cb8-200" data-line-number="200"><span class="co">#&gt;   gradient: -0.0605 0.0017 -0.162 -0.0354 -0.0926 -0.0083 -2.2061 0.2945 -0.1468 0.0797 -1.2189 0.2315 2e-04 </span></a>
<a class="sourceLine" id="cb8-201" data-line-number="201"><span class="co">#&gt; Using the heteroskedastic asymptotic variance-covariance matrix...</span></a>
<a class="sourceLine" id="cb8-202" data-line-number="202"></a>
<a class="sourceLine" id="cb8-203" data-line-number="203"><span class="kw">summary</span>(cereal_est)</a>
<a class="sourceLine" id="cb8-204" data-line-number="204"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-205" data-line-number="205"><span class="co">#&gt; Data information:</span></a>
<a class="sourceLine" id="cb8-206" data-line-number="206"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-207" data-line-number="207"><span class="co">#&gt;   94 market(s) with 2256 products </span></a>
<a class="sourceLine" id="cb8-208" data-line-number="208"><span class="co">#&gt;   25 linear coefficient(s) (24 exogenous coefficients) </span></a>
<a class="sourceLine" id="cb8-209" data-line-number="209"><span class="co">#&gt;   13 non-linear parameters related to random coefficients </span></a>
<a class="sourceLine" id="cb8-210" data-line-number="210"><span class="co">#&gt;   4 demographic variable(s) </span></a>
<a class="sourceLine" id="cb8-211" data-line-number="211"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-212" data-line-number="212"><span class="co">#&gt; Estimation results:</span></a>
<a class="sourceLine" id="cb8-213" data-line-number="213"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-214" data-line-number="214"><span class="co">#&gt;  Linear Coefficients</span></a>
<a class="sourceLine" id="cb8-215" data-line-number="215"><span class="co">#&gt;                          Estimate Std. Error   t value     Pr(&gt;|t|)</span></a>
<a class="sourceLine" id="cb8-216" data-line-number="216"><span class="co">#&gt; (Intercept)            -2.5769264  0.8531569 -3.020460 2.523909e-03</span></a>
<a class="sourceLine" id="cb8-217" data-line-number="217"><span class="co">#&gt; price                 -62.1403350 14.5135858 -4.281529 1.856137e-05</span></a>
<a class="sourceLine" id="cb8-218" data-line-number="218"><span class="co">#&gt; productdummyproduct10   1.9000897  0.6653478  2.855784 4.293071e-03</span></a>
<a class="sourceLine" id="cb8-219" data-line-number="219"><span class="co">#&gt; productdummyproduct11   3.6767952  0.6664428  5.517045 3.447468e-08</span></a>
<a class="sourceLine" id="cb8-220" data-line-number="220"><span class="co">#&gt; productdummyproduct12   0.2615994  0.2287542  1.143583 2.527967e-01</span></a>
<a class="sourceLine" id="cb8-221" data-line-number="221"><span class="co">#&gt; productdummyproduct13   2.3591835  0.2184213 10.801071 3.402135e-27</span></a>
<a class="sourceLine" id="cb8-222" data-line-number="222"><span class="co">#&gt; productdummyproduct14   3.8446786  0.6855662  5.608034 2.046376e-08</span></a>
<a class="sourceLine" id="cb8-223" data-line-number="223"><span class="co">#&gt; productdummyproduct15   4.2873240  0.6779154  6.324276 2.544228e-10</span></a>
<a class="sourceLine" id="cb8-224" data-line-number="224"><span class="co">#&gt; productdummyproduct16   6.0916947  0.6723137  9.060792 1.295068e-19</span></a>
<a class="sourceLine" id="cb8-225" data-line-number="225"><span class="co">#&gt; productdummyproduct17   2.6036321  0.6510521  3.999115 6.357976e-05</span></a>
<a class="sourceLine" id="cb8-226" data-line-number="226"><span class="co">#&gt; productdummyproduct18   1.4324858  0.6079004  2.356448 1.845065e-02</span></a>
<a class="sourceLine" id="cb8-227" data-line-number="227"><span class="co">#&gt; productdummyproduct19   4.3135147  0.6191372  6.966977 3.238237e-12</span></a>
<a class="sourceLine" id="cb8-228" data-line-number="228"><span class="co">#&gt; productdummyproduct2    4.8750516  0.6334282  7.696297 1.400664e-14</span></a>
<a class="sourceLine" id="cb8-229" data-line-number="229"><span class="co">#&gt; productdummyproduct20   4.1706988  0.6075700  6.864557 6.669789e-12</span></a>
<a class="sourceLine" id="cb8-230" data-line-number="230"><span class="co">#&gt; productdummyproduct21   4.9106550  0.6827987  7.191951 6.387201e-13</span></a>
<a class="sourceLine" id="cb8-231" data-line-number="231"><span class="co">#&gt; productdummyproduct22   1.7215961  0.5917418  2.909370 3.621574e-03</span></a>
<a class="sourceLine" id="cb8-232" data-line-number="232"><span class="co">#&gt; productdummyproduct23   3.2960677  0.6839398  4.819237 1.441085e-06</span></a>
<a class="sourceLine" id="cb8-233" data-line-number="233"><span class="co">#&gt; productdummyproduct24   1.8879979  0.7307294  2.583717 9.774202e-03</span></a>
<a class="sourceLine" id="cb8-234" data-line-number="234"><span class="co">#&gt; productdummyproduct3    2.3028803  0.2314068  9.951652 2.480314e-23</span></a>
<a class="sourceLine" id="cb8-235" data-line-number="235"><span class="co">#&gt; productdummyproduct4    1.3668373  0.5940217  2.300989 2.139225e-02</span></a>
<a class="sourceLine" id="cb8-236" data-line-number="236"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-237" data-line-number="237"><span class="co">#&gt; ...</span></a>
<a class="sourceLine" id="cb8-238" data-line-number="238"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-239" data-line-number="239"><span class="co">#&gt;  5 estimates are omitted. They are available in the LinCoefficients generated by summary.</span></a>
<a class="sourceLine" id="cb8-240" data-line-number="240"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-241" data-line-number="241"><span class="co">#&gt;  Random Coefficients</span></a>
<a class="sourceLine" id="cb8-242" data-line-number="242"><span class="co">#&gt;                           Estimate   Std. Error    t value     Pr(&gt;|t|)</span></a>
<a class="sourceLine" id="cb8-243" data-line-number="243"><span class="co">#&gt; unobs_sd*(Intercept)   0.551339802   0.16015070  3.4426313 0.0005760842</span></a>
<a class="sourceLine" id="cb8-244" data-line-number="244"><span class="co">#&gt; unobs_sd*price         3.285559241   1.30636137  2.5150462 0.0119016778</span></a>
<a class="sourceLine" id="cb8-245" data-line-number="245"><span class="co">#&gt; unobs_sd*sugar        -0.005237547   0.01336128 -0.3919943 0.6950624579</span></a>
<a class="sourceLine" id="cb8-246" data-line-number="246"><span class="co">#&gt; unobs_sd*mushy         0.091406886   0.18480221  0.4946201 0.6208683093</span></a>
<a class="sourceLine" id="cb8-247" data-line-number="247"><span class="co">#&gt; income*(Intercept)     2.303677743   1.19131427  1.9337280 0.0531465811</span></a>
<a class="sourceLine" id="cb8-248" data-line-number="248"><span class="co">#&gt; income*price         577.439894801 264.92313033  2.1796507 0.0292833612</span></a>
<a class="sourceLine" id="cb8-249" data-line-number="249"><span class="co">#&gt; income*sugar          -0.384035468   0.11965304 -3.2095755 0.0013293115</span></a>
<a class="sourceLine" id="cb8-250" data-line-number="250"><span class="co">#&gt; income*mushy           0.826450257   0.77955169  1.0601609 0.2890713880</span></a>
<a class="sourceLine" id="cb8-251" data-line-number="251"><span class="co">#&gt; incomesq*price       -29.627526239  13.80993188 -2.1453782 0.0319226238</span></a>
<a class="sourceLine" id="cb8-252" data-line-number="252"><span class="co">#&gt; age*(Intercept)        1.268858974   0.62894244  2.0174485 0.0436487312</span></a>
<a class="sourceLine" id="cb8-253" data-line-number="253"><span class="co">#&gt; age*sugar              0.051714014   0.02546546  2.0307513 0.0422802275</span></a>
<a class="sourceLine" id="cb8-254" data-line-number="254"><span class="co">#&gt; age*mushy             -1.350839887   0.66343728 -2.0361230 0.0417380079</span></a>
<a class="sourceLine" id="cb8-255" data-line-number="255"><span class="co">#&gt; child*price           11.025866516   4.11565257  2.6790081 0.0073840611</span></a>
<a class="sourceLine" id="cb8-256" data-line-number="256"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-257" data-line-number="257"><span class="co">#&gt;  Wald Test</span></a>
<a class="sourceLine" id="cb8-258" data-line-number="258"><span class="co">#&gt; 126.7789 on  13 DF, p-value: 9.13936399910884e-21 </span></a>
<a class="sourceLine" id="cb8-259" data-line-number="259"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb8-260" data-line-number="260"><span class="co">#&gt; Computational Details: </span></a>
<a class="sourceLine" id="cb8-261" data-line-number="261"><span class="co">#&gt;   Solver converged with 173 iterations to a minimum at 4.5744 .</span></a>
<a class="sourceLine" id="cb8-262" data-line-number="262"><span class="co">#&gt;   Local minima check: NA</span></a>
<a class="sourceLine" id="cb8-263" data-line-number="263"><span class="co">#&gt;   stopping criterion outer loop: 1e-06</span></a>
<a class="sourceLine" id="cb8-264" data-line-number="264"><span class="co">#&gt;   stopping criterion inner loop: 1e-06</span></a>
<a class="sourceLine" id="cb8-265" data-line-number="265"><span class="co">#&gt;   Market shares are integrated with provided_by_user and 20 draws. </span></a>
<a class="sourceLine" id="cb8-266" data-line-number="266"><span class="co">#&gt;   Method for standard errors: heteroskedastic</span></a></code></pre></div>
<p>The arguments in greater detail:</p>
<ul>
<li><p><code>par_theta2</code> gives initial values for non-linear parameters to be optimized over. Correct naming of columns and rows is important to allow correct matching.</p></li>
<li><p><code>solver_method</code>, <code>solver_maxit</code> , <code>solver_reltol</code>: solver related arguments that specify the R internal optimization (<code>optim</code> function). Additional arguments can be passed to optim via <code>...</code></p></li>
<li><p><code>standardError</code> can be specified as <code>homoskedastic</code>, <code>heteroskedastic</code> or <code>cluster</code>. The latter requires the variable <code>group_structure</code> in <code>productData</code> giving the related cluster.</p></li>
<li><p>if <code>extremumCheck</code> is <code>TRUE</code>, numerical derivatives at the solver optimum are used to check, if a local minimum was found</p></li>
<li><p><code>printLevel</code> controls for the amount of information that is provided during the estimation</p></li>
</ul>
<p>Many of these arguments have default values. In the following setting you see a minimum of necessary arguments with an automatic generation of integration draws and just unobserved heterogeneity. The summary output informs you about the most important default values.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">cereal_data2 &lt;-<span class="st"> </span><span class="kw">BLP_data</span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="dt">model =</span> nevos_model,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">market_identifier =</span> <span class="st">&quot;cdid&quot;</span>,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">product_identifier =</span> <span class="st">&quot;product_id&quot;</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">productData =</span> productData_cereal,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">integration_method =</span> <span class="st">&quot;MLHS&quot;</span>,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="dt">integration_accuracy =</span> <span class="dv">20</span>, <span class="dt">integration_seed =</span> <span class="dv">213</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; Mean utility (variable name: `delta`) is initialized with 0 because of missing or invalid par_delta argument.</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">cereal_est2 &lt;-<span class="st"> </span><span class="kw">estimateBLP</span>(<span class="dt">blp_data =</span> cereal_data2, <span class="dt">printLevel =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; blp_data were prepared with the following arguments:</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#&gt; BLP_data(model = nevos_model, market_identifier = &quot;cdid&quot;, product_identifier = &quot;product_id&quot;, </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#&gt;     productData = productData_cereal, integration_accuracy = 20, </span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#&gt;     integration_method = &quot;MLHS&quot;, integration_seed = 213)</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; Starting a BLP demand estimation with  2256  observations in  94  markets...</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#&gt; [integration::method  integration::amountDraws 20 ]</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt; [blp::inner_tol 1e-09  blp::inner_maxit 10000 ]</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; [solver::method BFGS  solver::maxit 10000  solver::reltol 1e-06 ]</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; gmm objective: 189.9432</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; gmm objective: 5632.612</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co">#&gt; gmm objective: 439.3216</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co">#&gt; gmm objective: 202.5585</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co">#&gt; gmm objective: 190.4644</span></a>
<a class="sourceLine" id="cb9-26" data-line-number="26"><span class="co">#&gt; gmm objective: 189.9569</span></a>
<a class="sourceLine" id="cb9-27" data-line-number="27"><span class="co">#&gt; gmm objective: 189.9422</span></a>
<a class="sourceLine" id="cb9-28" data-line-number="28"><span class="co">#&gt; gmm objective: 366.2611</span></a>
<a class="sourceLine" id="cb9-29" data-line-number="29"><span class="co">#&gt; gmm objective: 196.3801</span></a>
<a class="sourceLine" id="cb9-30" data-line-number="30"><span class="co">#&gt; gmm objective: 190.0315</span></a>
<a class="sourceLine" id="cb9-31" data-line-number="31"><span class="co">#&gt; gmm objective: 189.9122</span></a>
<a class="sourceLine" id="cb9-32" data-line-number="32"><span class="co">#&gt; gmm objective: 240.4055</span></a>
<a class="sourceLine" id="cb9-33" data-line-number="33"><span class="co">#&gt; gmm objective: 191.6947</span></a>
<a class="sourceLine" id="cb9-34" data-line-number="34"><span class="co">#&gt; gmm objective: 189.9326</span></a>
<a class="sourceLine" id="cb9-35" data-line-number="35"><span class="co">#&gt; gmm objective: 189.903</span></a>
<a class="sourceLine" id="cb9-36" data-line-number="36"><span class="co">#&gt; gmm objective: 189.8537</span></a>
<a class="sourceLine" id="cb9-37" data-line-number="37"><span class="co">#&gt; gmm objective: 189.8352</span></a>
<a class="sourceLine" id="cb9-38" data-line-number="38"><span class="co">#&gt; gmm objective: 189.8352</span></a>
<a class="sourceLine" id="cb9-39" data-line-number="39"><span class="co">#&gt; gmm objective: 212.3727</span></a>
<a class="sourceLine" id="cb9-40" data-line-number="40"><span class="co">#&gt; gmm objective: 190.7591</span></a>
<a class="sourceLine" id="cb9-41" data-line-number="41"><span class="co">#&gt; gmm objective: 189.8716</span></a>
<a class="sourceLine" id="cb9-42" data-line-number="42"><span class="co">#&gt; gmm objective: 189.8367</span></a>
<a class="sourceLine" id="cb9-43" data-line-number="43"><span class="co">#&gt; gmm objective: 189.8353</span></a>
<a class="sourceLine" id="cb9-44" data-line-number="44"><span class="co">#&gt; gmm objective: 189.8352</span></a>
<a class="sourceLine" id="cb9-45" data-line-number="45"><span class="co">#&gt; gmm objective: 189.8352</span></a>
<a class="sourceLine" id="cb9-46" data-line-number="46"><span class="co">#&gt; ------------------------------------------ </span></a>
<a class="sourceLine" id="cb9-47" data-line-number="47"><span class="co">#&gt; Solver message: Successful convergence </span></a>
<a class="sourceLine" id="cb9-48" data-line-number="48"><span class="co">#&gt; ------------------------------------------ </span></a>
<a class="sourceLine" id="cb9-49" data-line-number="49"><span class="co">#&gt; Final GMM evaluation at optimal parameters: </span></a>
<a class="sourceLine" id="cb9-50" data-line-number="50"><span class="co">#&gt; gmm objective: 189.8352</span></a>
<a class="sourceLine" id="cb9-51" data-line-number="51"><span class="co">#&gt;   theta (RC): 0 -0.32 0 0.06 </span></a>
<a class="sourceLine" id="cb9-52" data-line-number="52"><span class="co">#&gt;   theta (demogr.):  </span></a>
<a class="sourceLine" id="cb9-53" data-line-number="53"><span class="co">#&gt;   inner iterations: 61 </span></a>
<a class="sourceLine" id="cb9-54" data-line-number="54"><span class="co">#&gt;   gradient: 0 0 0.0316 0 </span></a>
<a class="sourceLine" id="cb9-55" data-line-number="55"><span class="co">#&gt; Using the heteroskedastic asymptotic variance-covariance matrix...</span></a>
<a class="sourceLine" id="cb9-56" data-line-number="56"></a>
<a class="sourceLine" id="cb9-57" data-line-number="57"><span class="kw">summary</span>(cereal_est2)</a>
<a class="sourceLine" id="cb9-58" data-line-number="58"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-59" data-line-number="59"><span class="co">#&gt; Data information:</span></a>
<a class="sourceLine" id="cb9-60" data-line-number="60"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-61" data-line-number="61"><span class="co">#&gt;   94 market(s) with 2256 products </span></a>
<a class="sourceLine" id="cb9-62" data-line-number="62"><span class="co">#&gt;   25 linear coefficient(s) (24 exogenous coefficients) </span></a>
<a class="sourceLine" id="cb9-63" data-line-number="63"><span class="co">#&gt;   4 non-linear parameters related to random coefficients </span></a>
<a class="sourceLine" id="cb9-64" data-line-number="64"><span class="co">#&gt;   0 demographic variable(s) </span></a>
<a class="sourceLine" id="cb9-65" data-line-number="65"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-66" data-line-number="66"><span class="co">#&gt; Estimation results:</span></a>
<a class="sourceLine" id="cb9-67" data-line-number="67"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-68" data-line-number="68"><span class="co">#&gt;  Linear Coefficients</span></a>
<a class="sourceLine" id="cb9-69" data-line-number="69"><span class="co">#&gt;                          Estimate Std. Error    t value      Pr(&gt;|t|)</span></a>
<a class="sourceLine" id="cb9-70" data-line-number="70"><span class="co">#&gt; (Intercept)            -1.7731873  0.1602903 -11.062350  1.910261e-28</span></a>
<a class="sourceLine" id="cb9-71" data-line-number="71"><span class="co">#&gt; price                 -30.1150257  1.2899147 -23.346526 1.494838e-120</span></a>
<a class="sourceLine" id="cb9-72" data-line-number="72"><span class="co">#&gt; productdummyproduct10   1.8588694  0.1680453  11.061715  1.923839e-28</span></a>
<a class="sourceLine" id="cb9-73" data-line-number="73"><span class="co">#&gt; productdummyproduct11   1.7623940  0.1495181  11.787162  4.546047e-32</span></a>
<a class="sourceLine" id="cb9-74" data-line-number="74"><span class="co">#&gt; productdummyproduct12  -0.2874741  0.1592495  -1.805180  7.104647e-02</span></a>
<a class="sourceLine" id="cb9-75" data-line-number="75"><span class="co">#&gt; productdummyproduct13   2.2500443  0.1511584  14.885338  4.104043e-50</span></a>
<a class="sourceLine" id="cb9-76" data-line-number="76"><span class="co">#&gt; productdummyproduct14   1.7795210  0.1626780  10.938918  7.509066e-28</span></a>
<a class="sourceLine" id="cb9-77" data-line-number="77"><span class="co">#&gt; productdummyproduct15   2.1598572  0.1600857  13.491879  1.745928e-41</span></a>
<a class="sourceLine" id="cb9-78" data-line-number="78"><span class="co">#&gt; productdummyproduct16   3.6903310  0.1718044  21.479845 2.403069e-102</span></a>
<a class="sourceLine" id="cb9-79" data-line-number="79"><span class="co">#&gt; productdummyproduct17   0.7890090  0.1696815   4.649940  3.320313e-06</span></a>
<a class="sourceLine" id="cb9-80" data-line-number="80"><span class="co">#&gt; productdummyproduct18   0.8752804  0.1637558   5.345035  9.039982e-08</span></a>
<a class="sourceLine" id="cb9-81" data-line-number="81"><span class="co">#&gt; productdummyproduct19   1.7678372  0.1493846  11.834129  2.600273e-32</span></a>
<a class="sourceLine" id="cb9-82" data-line-number="82"><span class="co">#&gt; productdummyproduct2    2.3665019  0.1535953  15.407387  1.459966e-53</span></a>
<a class="sourceLine" id="cb9-83" data-line-number="83"><span class="co">#&gt; productdummyproduct20   2.8086743  0.1635328  17.174992  4.087069e-66</span></a>
<a class="sourceLine" id="cb9-84" data-line-number="84"><span class="co">#&gt; productdummyproduct21   2.6809487  0.1689161  15.871478  9.986136e-57</span></a>
<a class="sourceLine" id="cb9-85" data-line-number="85"><span class="co">#&gt; productdummyproduct22   0.4722649  0.1546958   3.052862  2.266698e-03</span></a>
<a class="sourceLine" id="cb9-86" data-line-number="86"><span class="co">#&gt; productdummyproduct23   1.3755276  0.1541332   8.924278  4.486152e-19</span></a>
<a class="sourceLine" id="cb9-87" data-line-number="87"><span class="co">#&gt; productdummyproduct24   2.1728901  0.1699102  12.788464  1.901958e-37</span></a>
<a class="sourceLine" id="cb9-88" data-line-number="88"><span class="co">#&gt; productdummyproduct3    1.8016223  0.1488931  12.100102  1.054799e-33</span></a>
<a class="sourceLine" id="cb9-89" data-line-number="89"><span class="co">#&gt; productdummyproduct4    0.7639859  0.1468578   5.202216  1.969266e-07</span></a>
<a class="sourceLine" id="cb9-90" data-line-number="90"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-91" data-line-number="91"><span class="co">#&gt; ...</span></a>
<a class="sourceLine" id="cb9-92" data-line-number="92"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-93" data-line-number="93"><span class="co">#&gt;  5 estimates are omitted. They are available in the LinCoefficients generated by summary.</span></a>
<a class="sourceLine" id="cb9-94" data-line-number="94"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-95" data-line-number="95"><span class="co">#&gt;  Random Coefficients</span></a>
<a class="sourceLine" id="cb9-96" data-line-number="96"><span class="co">#&gt;                           Estimate Std. Error      t value  Pr(&gt;|t|)</span></a>
<a class="sourceLine" id="cb9-97" data-line-number="97"><span class="co">#&gt; unobs_sd*(Intercept) -0.0028937363  1.1219334 -0.002579241 0.9979421</span></a>
<a class="sourceLine" id="cb9-98" data-line-number="98"><span class="co">#&gt; unobs_sd*price       -0.3179154684  9.1643440 -0.034690478 0.9723266</span></a>
<a class="sourceLine" id="cb9-99" data-line-number="99"><span class="co">#&gt; unobs_sd*sugar       -0.0003841069  0.1139372 -0.003371217 0.9973102</span></a>
<a class="sourceLine" id="cb9-100" data-line-number="100"><span class="co">#&gt; unobs_sd*mushy        0.0603775693  2.2758039  0.026530216 0.9788344</span></a>
<a class="sourceLine" id="cb9-101" data-line-number="101"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-102" data-line-number="102"><span class="co">#&gt;  Wald Test</span></a>
<a class="sourceLine" id="cb9-103" data-line-number="103"><span class="co">#&gt; 0.0018 on  4 DF, p-value: 0.9999995836557 </span></a>
<a class="sourceLine" id="cb9-104" data-line-number="104"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-105" data-line-number="105"><span class="co">#&gt; Computational Details: </span></a>
<a class="sourceLine" id="cb9-106" data-line-number="106"><span class="co">#&gt;   Solver converged with 25 iterations to a minimum at 189.8352 .</span></a>
<a class="sourceLine" id="cb9-107" data-line-number="107"><span class="co">#&gt;   Local minima check: NA</span></a>
<a class="sourceLine" id="cb9-108" data-line-number="108"><span class="co">#&gt;   stopping criterion outer loop: 1e-06</span></a>
<a class="sourceLine" id="cb9-109" data-line-number="109"><span class="co">#&gt;   stopping criterion inner loop: 1e-09</span></a>
<a class="sourceLine" id="cb9-110" data-line-number="110"><span class="co">#&gt;   Market shares are integrated with MLHS and 20 draws. </span></a>
<a class="sourceLine" id="cb9-111" data-line-number="111"><span class="co">#&gt;   Method for standard errors: heteroskedastic</span></a></code></pre></div>
</div>
</div>
<div id="postestimation" class="section level1">
<h1>Postestimation</h1>
<div id="standard-errors" class="section level2">
<h2>Standard Errors</h2>
<p>Standard errors can be computed with three options that control for the unobserved characteristic <span class="math inline">\(\xi\)</span>, which consists of <span class="math inline">\(N\)</span> elements. <span class="math inline">\(\Omega\)</span> denotes the variance covariance matrix of <span class="math inline">\(\xi\)</span>.</p>
<ul>
<li><p>option <code>homoskedastic</code> requires the standard deviation <span class="math inline">\(\sigma_i\)</span> for each <span class="math inline">\(\xi_i \;\forall i\in 1,\cdots,N\)</span> to be identical: <span class="math display">\[\Omega = \begin{pmatrix} \sigma &amp; 0 &amp;
\dots &amp; 0\\ 0 &amp; \sigma &amp;  &amp; 0\\ \vdots &amp;  &amp; \ddots &amp; 0\\
0 &amp; 0 &amp; 0 &amp; \sigma \\ \end{pmatrix}\]</span></p></li>
<li><p>option <code>heteroskedastic</code> allows for individual standard deviations <span class="math inline">\(\sigma_i\)</span> for each <span class="math inline">\(\xi_i\)</span> : <span class="math display">\[\Omega = \begin{pmatrix} \sigma_1 &amp; 0 &amp;
\dots &amp; 0\\
0 &amp; \sigma_2 &amp;  &amp; 0\\
\vdots &amp;  &amp; \ddots &amp; 0\\
0 &amp; 0 &amp; 0 &amp; \sigma_N \\ \end{pmatrix}\]</span></p></li>
<li><p>option <code>cluster</code> allows for cluster individual variance covariance matrices in each of <span class="math inline">\(M\)</span> cluster groups. For this option the argument <code>group_structure</code> needs to be specified in the function <code>BLP_data</code> to determine the cluster group. This gives the block-diagonal form with <span class="math inline">\(\Sigma_m\)</span> as the variance covariance matrix for all <span class="math inline">\(\xi_i\)</span> in cluster <span class="math inline">\(m\)</span>:</p></li>
</ul>
<p><span class="math display">\[\Omega = \begin{pmatrix} \Sigma_1 &amp; 0 &amp;
\dots &amp; 0\\
0 &amp; \Sigma_2 &amp;  &amp; 0\\
\vdots &amp;  &amp; \ddots &amp; 0\\
0 &amp; 0 &amp; 0 &amp; \Sigma_M \\ \end{pmatrix}\]</span></p>
</div>
<div id="elasticities" class="section level2">
<h2>Elasticities</h2>
<p>The following code demonstrates the calculation of elasticities for the estimation object <code>cereal_est</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># extract parameters from output</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">theta1_price &lt;-<span class="st"> </span>cereal_est<span class="op">$</span>theta_lin[<span class="st">&quot;price&quot;</span>, ]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">theta2 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">ncol =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="kw">colnames</span>(theta2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;unobs_sd&quot;</span>, <span class="st">&quot;income&quot;</span>, <span class="st">&quot;incomesq&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;child&quot;</span>)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">rownames</span>(theta2) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;(Intercept)&quot;</span>, <span class="st">&quot;price&quot;</span>, <span class="st">&quot;sugar&quot;</span>, <span class="st">&quot;mushy&quot;</span>)</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">13</span>) {</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  theta2[cereal_est<span class="op">$</span>indices[i, <span class="dv">1</span>], cereal_est<span class="op">$</span>indices[i, <span class="dv">2</span>]] &lt;-<span class="st"> </span>cereal_est<span class="op">$</span>theta_rc[i]</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb10-9" data-line-number="9"></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">delta_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">  <span class="st">&quot;product_id&quot;</span> =<span class="st"> </span>cereal_data<span class="op">$</span>parameters<span class="op">$</span>product_id,</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">  <span class="st">&quot;cdid&quot;</span> =<span class="st"> </span>cereal_data<span class="op">$</span>parameters<span class="op">$</span>market_id_char_in,</a>
<a class="sourceLine" id="cb10-13" data-line-number="13">  <span class="st">&quot;startingGuessesDelta&quot;</span> =<span class="st"> </span>cereal_est<span class="op">$</span>delta</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co"># always use update_BLP_data() to update data object to maintain consistent data</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16">cereal_data &lt;-<span class="st"> </span><span class="kw">update_BLP_data</span>(</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">  <span class="dt">data_update =</span> delta_data,</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">  <span class="dt">blp_data =</span> cereal_data</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; Mean utility variable startingGuessesDelta has been updated.</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"></a>
<a class="sourceLine" id="cb10-22" data-line-number="22">shareObj &lt;-<span class="st"> </span><span class="kw">getShareInfo</span>(</a>
<a class="sourceLine" id="cb10-23" data-line-number="23">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb10-24" data-line-number="24">  <span class="dt">par_theta2 =</span> theta2,</a>
<a class="sourceLine" id="cb10-25" data-line-number="25">  <span class="dt">printLevel =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb10-26" data-line-number="26">)</a>
<a class="sourceLine" id="cb10-27" data-line-number="27"><span class="co">#&gt; Mean utility (delta) is used as provided in the BLP_data() function.</span></a>
<a class="sourceLine" id="cb10-28" data-line-number="28"></a>
<a class="sourceLine" id="cb10-29" data-line-number="29"><span class="kw">get_elasticities</span>(</a>
<a class="sourceLine" id="cb10-30" data-line-number="30">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb10-31" data-line-number="31">  <span class="dt">share_info =</span> shareObj,</a>
<a class="sourceLine" id="cb10-32" data-line-number="32">  <span class="dt">theta_lin =</span> theta1_price,</a>
<a class="sourceLine" id="cb10-33" data-line-number="33">  <span class="dt">variable =</span> <span class="st">&quot;price&quot;</span>,</a>
<a class="sourceLine" id="cb10-34" data-line-number="34">  <span class="dt">products =</span> <span class="kw">c</span>(<span class="st">&quot;cereal_1&quot;</span>, <span class="st">&quot;cereal_4&quot;</span>),</a>
<a class="sourceLine" id="cb10-35" data-line-number="35">  <span class="dt">market =</span> <span class="st">&quot;market_2&quot;</span></a>
<a class="sourceLine" id="cb10-36" data-line-number="36">)</a>
<a class="sourceLine" id="cb10-37" data-line-number="37"><span class="co">#&gt;              cereal_1     cereal_4</span></a>
<a class="sourceLine" id="cb10-38" data-line-number="38"><span class="co">#&gt; cereal_1 -1.710300059  0.005433147</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"><span class="co">#&gt; cereal_4  0.006965292 -2.717589276</span></a></code></pre></div>
<p>The value of the elasticity matrix in row <span class="math inline">\(j\)</span> and column <span class="math inline">\(i\)</span> for a variable <span class="math inline">\(x\)</span>, gives the effect of a change in product <span class="math inline">\(i\)</span>’s characteristic <span class="math inline">\(x\)</span> on the share of product <span class="math inline">\(j\)</span>.</p>
</div>
</div>
<div id="modular-examples" class="section level1">
<h1>Modular Examples</h1>
<p>Further analysis like incorporating a supply side or performing a merger simulation often requires access to building blocks of the BLP algorithm. The following wrappers insure correct data inputs and access the internal functions of the algorithm.</p>
<p>In the following, you find an example of the contraction mapping and an evaluation of the GMM function at the starting guess:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">delta_eval &lt;-<span class="st"> </span><span class="kw">getDelta_wrap</span>(</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">printLevel =</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; ----------------------</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt;   dist: 0.230998</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt;   dist: 0.188133</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;   dist: 0.161181</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;   dist: 0.133303</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt;   dist: 0.107161</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt;   dist: 0.0844808</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt;   dist: 0.0657196</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt;   dist: 0.0506556</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt;   dist: 0.0387915</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt;   dist: 0.0295683</span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;   dist: 0.0224622</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt;   dist: 0.0170219</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt;   dist: 0.0128758</span></a>
<a class="sourceLine" id="cb11-20" data-line-number="20"><span class="co">#&gt;   dist: 0.00972657</span></a>
<a class="sourceLine" id="cb11-21" data-line-number="21"><span class="co">#&gt;   dist: 0.00734024</span></a>
<a class="sourceLine" id="cb11-22" data-line-number="22"><span class="co">#&gt;   dist: 0.00553524</span></a>
<a class="sourceLine" id="cb11-23" data-line-number="23"><span class="co">#&gt;   dist: 0.00417178</span></a>
<a class="sourceLine" id="cb11-24" data-line-number="24"><span class="co">#&gt;   dist: 0.00314287</span></a>
<a class="sourceLine" id="cb11-25" data-line-number="25"><span class="co">#&gt;   dist: 0.00236698</span></a>
<a class="sourceLine" id="cb11-26" data-line-number="26"><span class="co">#&gt;   dist: 0.00178222</span></a>
<a class="sourceLine" id="cb11-27" data-line-number="27"><span class="co">#&gt;   dist: 0.00134169</span></a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="co">#&gt;   dist: 0.00100991</span></a>
<a class="sourceLine" id="cb11-29" data-line-number="29"><span class="co">#&gt;   dist: 0.000760105</span></a>
<a class="sourceLine" id="cb11-30" data-line-number="30"><span class="co">#&gt;   dist: 0.000572046</span></a>
<a class="sourceLine" id="cb11-31" data-line-number="31"><span class="co">#&gt;   dist: 0.000430491</span></a>
<a class="sourceLine" id="cb11-32" data-line-number="32"><span class="co">#&gt;   dist: 0.00032395</span></a>
<a class="sourceLine" id="cb11-33" data-line-number="33"><span class="co">#&gt;   dist: 0.000243769</span></a>
<a class="sourceLine" id="cb11-34" data-line-number="34"><span class="co">#&gt;   dist: 0.00019173</span></a>
<a class="sourceLine" id="cb11-35" data-line-number="35"><span class="co">#&gt;   dist: 0.000156244</span></a>
<a class="sourceLine" id="cb11-36" data-line-number="36"><span class="co">#&gt;   dist: 0.000127321</span></a>
<a class="sourceLine" id="cb11-37" data-line-number="37"><span class="co">#&gt;   dist: 0.000103748</span></a>
<a class="sourceLine" id="cb11-38" data-line-number="38"><span class="co">#&gt;   dist: 8.45372e-05</span></a>
<a class="sourceLine" id="cb11-39" data-line-number="39"><span class="co">#&gt;   dist: 6.88821e-05</span></a>
<a class="sourceLine" id="cb11-40" data-line-number="40"><span class="co">#&gt;   dist: 5.61251e-05</span></a>
<a class="sourceLine" id="cb11-41" data-line-number="41"><span class="co">#&gt;   dist: 4.573e-05</span></a>
<a class="sourceLine" id="cb11-42" data-line-number="42"><span class="co">#&gt;   dist: 3.72598e-05</span></a>
<a class="sourceLine" id="cb11-43" data-line-number="43"><span class="co">#&gt;   dist: 3.03582e-05</span></a>
<a class="sourceLine" id="cb11-44" data-line-number="44"><span class="co">#&gt;   dist: 2.47347e-05</span></a>
<a class="sourceLine" id="cb11-45" data-line-number="45"><span class="co">#&gt;   dist: 2.01528e-05</span></a>
<a class="sourceLine" id="cb11-46" data-line-number="46"><span class="co">#&gt;   dist: 1.64195e-05</span></a>
<a class="sourceLine" id="cb11-47" data-line-number="47"><span class="co">#&gt;   dist: 1.33778e-05</span></a>
<a class="sourceLine" id="cb11-48" data-line-number="48"><span class="co">#&gt;   dist: 1.08995e-05</span></a>
<a class="sourceLine" id="cb11-49" data-line-number="49"><span class="co">#&gt;   dist: 8.88033e-06</span></a>
<a class="sourceLine" id="cb11-50" data-line-number="50"><span class="co">#&gt;   dist: 7.23518e-06</span></a>
<a class="sourceLine" id="cb11-51" data-line-number="51"><span class="co">#&gt;   dist: 5.8948e-06</span></a>
<a class="sourceLine" id="cb11-52" data-line-number="52"><span class="co">#&gt;   dist: 4.80272e-06</span></a>
<a class="sourceLine" id="cb11-53" data-line-number="53"><span class="co">#&gt;   dist: 3.91296e-06</span></a>
<a class="sourceLine" id="cb11-54" data-line-number="54"><span class="co">#&gt;   dist: 3.18804e-06</span></a>
<a class="sourceLine" id="cb11-55" data-line-number="55"><span class="co">#&gt;   dist: 2.59741e-06</span></a>
<a class="sourceLine" id="cb11-56" data-line-number="56"><span class="co">#&gt;   dist: 2.14713e-06</span></a>
<a class="sourceLine" id="cb11-57" data-line-number="57"><span class="co">#&gt;   dist: 1.78121e-06</span></a>
<a class="sourceLine" id="cb11-58" data-line-number="58"><span class="co">#&gt;   dist: 1.47765e-06</span></a>
<a class="sourceLine" id="cb11-59" data-line-number="59"><span class="co">#&gt;   dist: 1.22582e-06</span></a>
<a class="sourceLine" id="cb11-60" data-line-number="60"><span class="co">#&gt;   dist: 1.01691e-06</span></a>
<a class="sourceLine" id="cb11-61" data-line-number="61"><span class="co">#&gt;   dist: 9.93231e-07</span></a>
<a class="sourceLine" id="cb11-62" data-line-number="62"></a>
<a class="sourceLine" id="cb11-63" data-line-number="63">productData_cereal<span class="op">$</span>startingGuessesDelta[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb11-64" data-line-number="64"><span class="co">#&gt; [1] -3.944367 -2.845205 -3.958199 -4.934153 -2.425356 -4.086816</span></a>
<a class="sourceLine" id="cb11-65" data-line-number="65">delta_eval<span class="op">$</span>delta[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb11-66" data-line-number="66"><span class="co">#&gt; cereal_1_market_1 cereal_2_market_1 cereal_3_market_1 cereal_4_market_1 </span></a>
<a class="sourceLine" id="cb11-67" data-line-number="67"><span class="co">#&gt;         -7.069801         -4.357675         -6.056909         -5.887501 </span></a>
<a class="sourceLine" id="cb11-68" data-line-number="68"><span class="co">#&gt; cereal_5_market_1 cereal_6_market_1 </span></a>
<a class="sourceLine" id="cb11-69" data-line-number="69"><span class="co">#&gt;         -3.501289         -3.079323</span></a>
<a class="sourceLine" id="cb11-70" data-line-number="70">delta_eval<span class="op">$</span>counter</a>
<a class="sourceLine" id="cb11-71" data-line-number="71"><span class="co">#&gt; [1] 55</span></a>
<a class="sourceLine" id="cb11-72" data-line-number="72"></a>
<a class="sourceLine" id="cb11-73" data-line-number="73">gmm &lt;-<span class="st"> </span><span class="kw">gmm_obj_wrap</span>(</a>
<a class="sourceLine" id="cb11-74" data-line-number="74">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb11-75" data-line-number="75">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb11-76" data-line-number="76">  <span class="dt">printLevel =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb11-77" data-line-number="77">)</a>
<a class="sourceLine" id="cb11-78" data-line-number="78"><span class="co">#&gt; gmm objective: 29.3544</span></a>
<a class="sourceLine" id="cb11-79" data-line-number="79"><span class="co">#&gt;   theta (RC): 0.33 2.45 0.02 0.24 </span></a>
<a class="sourceLine" id="cb11-80" data-line-number="80"><span class="co">#&gt;   theta (demogr.): 5.48 15.89 -0.25 1.26 0 -1.2 0 0 0.2 0 0.05 -0.81 0 2.63 0 0 </span></a>
<a class="sourceLine" id="cb11-81" data-line-number="81"><span class="co">#&gt;   inner iterations: 55 </span></a>
<a class="sourceLine" id="cb11-82" data-line-number="82"><span class="co">#&gt;   gradient: 9.8468 0.3171 363.5319 16.3598 10.6031 0.7028 42.5236 -3.4759 13.4982 -2.0231 10.9331 1.2851 -0.5714 </span></a>
<a class="sourceLine" id="cb11-83" data-line-number="83"><span class="co">#&gt; [1] 29.35439</span></a>
<a class="sourceLine" id="cb11-84" data-line-number="84"></a>
<a class="sourceLine" id="cb11-85" data-line-number="85">gmm<span class="op">$</span>local_min</a>
<a class="sourceLine" id="cb11-86" data-line-number="86"><span class="co">#&gt; [1] 29.35439</span></a></code></pre></div>
<p>Printed distances in the contraction mapping are maximum absolute distances between the current vector of mean utilities and the previous one.</p>
<p>For any <span class="math inline">\(\theta_2\)</span>, you can compute predicted shares:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">shareObj &lt;-<span class="st"> </span><span class="kw">getShareInfo</span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  <span class="dt">printLevel =</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt; Mean utility (delta) is used as provided in the BLP_data() function.</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"></a>
<a class="sourceLine" id="cb12-8" data-line-number="8">shareObj<span class="op">$</span>shares[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]</a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt; cereal_1_market_1 cereal_2_market_1 cereal_3_market_1 cereal_4_market_1 </span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt;       0.052856545       0.002175260       0.006105588       0.001529422 </span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; cereal_5_market_1 cereal_6_market_1 </span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;       0.001571742       0.003654192</span></a></code></pre></div>
<p>The object contains a list of outputs that are useful for further economic analysis. For example, the list element <code>sij</code> contains share probabilities for every individual and needs to be given to calculate elasticities.</p>
<p>The gradient contains two important building blocks as explained in the appendix of <span class="citation">Nevo (2001)</span>:</p>
<ul>
<li><p><span class="math inline">\(\frac{\partial s_{ijt}}{\partial \theta_2}\)</span> , i.e. the derivative of individual <span class="math inline">\(i\)</span>’s share of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span> with respect to non-linear parameters</p></li>
<li><p><span class="math inline">\(\frac{\partial s_{ijt}}{\partial \delta}\)</span> , i.e. the derivative of individual <span class="math inline">\(i\)</span>’s share of product <span class="math inline">\(j\)</span> in market <span class="math inline">\(t\)</span> with respect to mean utilities</p></li>
</ul>
<p>Both are used to compute the jacobian and are easy to obtain with the package as the following example demonstrates:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># market 2:</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">derivatives1 &lt;-<span class="st"> </span><span class="kw">dstdtheta_wrap</span>(</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  <span class="dt">market =</span> <span class="st">&quot;market_2&quot;</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt; Mean utility (delta) is used as provided in the BLP_data() function.</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8">derivatives2 &lt;-<span class="st"> </span><span class="kw">dstddelta_wrap</span>(</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">  <span class="dt">market =</span> <span class="st">&quot;market_2&quot;</span></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#&gt; Mean utility (delta) is used as provided in the BLP_data() function.</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"></a>
<a class="sourceLine" id="cb13-15" data-line-number="15">jac_mkt2 &lt;-<span class="st"> </span><span class="op">-</span><span class="kw">solve</span>(derivatives2) <span class="op">%*%</span><span class="st"> </span>derivatives1</a>
<a class="sourceLine" id="cb13-16" data-line-number="16"></a>
<a class="sourceLine" id="cb13-17" data-line-number="17">jac_mkt2[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]</a>
<a class="sourceLine" id="cb13-18" data-line-number="18"><span class="co">#&gt;                      unobs_sd*(Intercept) unobs_sd*price unobs_sd*sugar</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="co">#&gt; meanUtility_cereal_1           -0.3935523    0.010936676      -1.430109</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="co">#&gt; meanUtility_cereal_2           -0.5385401    0.002959190      -8.608901</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="co">#&gt; meanUtility_cereal_3           -0.4567829    0.003935221      -2.612346</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="co">#&gt; meanUtility_cereal_4           -0.7766701   -0.022430917      -1.567758</span></a>
<a class="sourceLine" id="cb13-23" data-line-number="23"><span class="co">#&gt; meanUtility_cereal_5           -0.7821670   -0.085051524      -2.722660</span></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co">#&gt;                      unobs_sd*mushy</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#&gt; meanUtility_cereal_1    -0.47865751</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26"><span class="co">#&gt; meanUtility_cereal_2    -0.20678073</span></a>
<a class="sourceLine" id="cb13-27" data-line-number="27"><span class="co">#&gt; meanUtility_cereal_3    -0.43499042</span></a>
<a class="sourceLine" id="cb13-28" data-line-number="28"><span class="co">#&gt; meanUtility_cereal_4    -0.04046717</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29"><span class="co">#&gt; meanUtility_cereal_5    -0.04388127</span></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co"># all markets</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32">jacobian_nevo &lt;-<span class="st"> </span><span class="kw">getJacobian_wrap</span>(</a>
<a class="sourceLine" id="cb13-33" data-line-number="33">  <span class="dt">blp_data =</span> cereal_data,</a>
<a class="sourceLine" id="cb13-34" data-line-number="34">  <span class="dt">par_theta2 =</span> theta_guesses_cereal,</a>
<a class="sourceLine" id="cb13-35" data-line-number="35">  <span class="dt">printLevel =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb13-36" data-line-number="36">)</a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="co">#&gt; Mean utility (delta) is used as provided in the BLP_data() function.</span></a>
<a class="sourceLine" id="cb13-38" data-line-number="38"></a>
<a class="sourceLine" id="cb13-39" data-line-number="39">jacobian_nevo[<span class="dv">25</span><span class="op">:</span><span class="dv">29</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>] <span class="co"># compare to jac_mkt2</span></a>
<a class="sourceLine" id="cb13-40" data-line-number="40"><span class="co">#&gt;                   unobs_sd*(Intercept) unobs_sd*price unobs_sd*sugar</span></a>
<a class="sourceLine" id="cb13-41" data-line-number="41"><span class="co">#&gt; cereal_1_market_2           -0.3935523    0.010936676      -1.430109</span></a>
<a class="sourceLine" id="cb13-42" data-line-number="42"><span class="co">#&gt; cereal_2_market_2           -0.5385401    0.002959190      -8.608901</span></a>
<a class="sourceLine" id="cb13-43" data-line-number="43"><span class="co">#&gt; cereal_3_market_2           -0.4567829    0.003935221      -2.612346</span></a>
<a class="sourceLine" id="cb13-44" data-line-number="44"><span class="co">#&gt; cereal_4_market_2           -0.7766701   -0.022430917      -1.567758</span></a>
<a class="sourceLine" id="cb13-45" data-line-number="45"><span class="co">#&gt; cereal_5_market_2           -0.7821670   -0.085051524      -2.722660</span></a>
<a class="sourceLine" id="cb13-46" data-line-number="46"><span class="co">#&gt;                   unobs_sd*mushy</span></a>
<a class="sourceLine" id="cb13-47" data-line-number="47"><span class="co">#&gt; cereal_1_market_2    -0.47865751</span></a>
<a class="sourceLine" id="cb13-48" data-line-number="48"><span class="co">#&gt; cereal_2_market_2    -0.20678073</span></a>
<a class="sourceLine" id="cb13-49" data-line-number="49"><span class="co">#&gt; cereal_3_market_2    -0.43499042</span></a>
<a class="sourceLine" id="cb13-50" data-line-number="50"><span class="co">#&gt; cereal_4_market_2    -0.04046717</span></a>
<a class="sourceLine" id="cb13-51" data-line-number="51"><span class="co">#&gt; cereal_5_market_2    -0.04388127</span></a></code></pre></div>
</div>
<div id="another-example-merger-analysis-with-blps-car-data" class="section level1">
<h1>Another Example: Merger Analysis with BLP’s car data</h1>
<p>Analyzing a hypothetical merger is demonstrated by the car data of <span class="citation">Berry, Levinsohn, and Pakes (1995)</span>. In this case, the preparation of product data comprises the computation of instruments as a function of product characteristics of competitors’ products (for details, check <span class="citation">Berry, Levinsohn, and Pakes (1995)</span>). This example is based on data and documentation of <span class="citation">Knittel and Metaxoglou (2014)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># add owner matix to productData</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">own_pre &lt;-<span class="st"> </span>dummies_cars</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw">colnames</span>(own_pre) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;company&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">26</span>)</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">productData_cars &lt;-<span class="st"> </span><span class="kw">cbind</span>(productData_cars, own_pre)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co"># construct instruments</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">nobs &lt;-<span class="st"> </span><span class="kw">nrow</span>(productData_cars)</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">X &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">  productData_cars<span class="op">$</span>const, productData_cars<span class="op">$</span>hpwt,</a>
<a class="sourceLine" id="cb14-10" data-line-number="10">  productData_cars<span class="op">$</span>air, productData_cars<span class="op">$</span>mpg, productData_cars<span class="op">$</span>space</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"></a>
<a class="sourceLine" id="cb14-13" data-line-number="13">sum_other &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, nobs, <span class="kw">ncol</span>(X))</a>
<a class="sourceLine" id="cb14-14" data-line-number="14">sum_rival &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, nobs, <span class="kw">ncol</span>(X))</a>
<a class="sourceLine" id="cb14-15" data-line-number="15">sum_total &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, nobs, <span class="kw">ncol</span>(X))</a>
<a class="sourceLine" id="cb14-16" data-line-number="16"></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nobs) {</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">  other_ind &lt;-<span class="st"> </span>productData_cars<span class="op">$</span>firmid <span class="op">==</span><span class="st"> </span>productData_cars<span class="op">$</span>firmid[i] <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="st">    </span>productData_cars<span class="op">$</span>cdid <span class="op">==</span><span class="st"> </span>productData_cars<span class="op">$</span>cdid[i] <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="st">    </span>productData_cars<span class="op">$</span>id <span class="op">!=</span><span class="st"> </span>productData_cars<span class="op">$</span>id[i]</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">  rival_ind &lt;-<span class="st"> </span>productData_cars<span class="op">$</span>firmid <span class="op">!=</span><span class="st"> </span>productData_cars<span class="op">$</span>firmid[i] <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="st">    </span>productData_cars<span class="op">$</span>cdid <span class="op">==</span><span class="st"> </span>productData_cars<span class="op">$</span>cdid[i]</a>
<a class="sourceLine" id="cb14-23" data-line-number="23">  total_ind &lt;-<span class="st"> </span>productData_cars<span class="op">$</span>cdid <span class="op">==</span><span class="st"> </span>productData_cars<span class="op">$</span>cdid[i]</a>
<a class="sourceLine" id="cb14-24" data-line-number="24"></a>
<a class="sourceLine" id="cb14-25" data-line-number="25">  sum_other[i, ] &lt;-<span class="st"> </span><span class="kw">colSums</span>(X[other_ind <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ])</a>
<a class="sourceLine" id="cb14-26" data-line-number="26">  sum_rival[i, ] &lt;-<span class="st"> </span><span class="kw">colSums</span>(X[rival_ind <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ])</a>
<a class="sourceLine" id="cb14-27" data-line-number="27">  sum_total[i, ] &lt;-<span class="st"> </span><span class="kw">colSums</span>(X[total_ind <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ])</a>
<a class="sourceLine" id="cb14-28" data-line-number="28">}</a>
<a class="sourceLine" id="cb14-29" data-line-number="29"></a>
<a class="sourceLine" id="cb14-30" data-line-number="30"><span class="kw">colnames</span>(sum_other) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;IV&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb14-31" data-line-number="31"><span class="kw">colnames</span>(sum_rival) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;IV&quot;</span>, <span class="dv">6</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb14-32" data-line-number="32">productData_cars &lt;-<span class="st"> </span><span class="kw">cbind</span>(productData_cars, sum_other, sum_rival)</a>
<a class="sourceLine" id="cb14-33" data-line-number="33"><span class="kw">head</span>(productData_cars)</a>
<a class="sourceLine" id="cb14-34" data-line-number="34"><span class="co">#&gt;   firmid cdid  id const    price      hpwt air   mpg  space        share</span></a>
<a class="sourceLine" id="cb14-35" data-line-number="35"><span class="co">#&gt; 1     15    1 129     1 4.935802 0.5289969   0 1.697 1.1502 0.0010512928</span></a>
<a class="sourceLine" id="cb14-36" data-line-number="36"><span class="co">#&gt; 2     15    1 130     1 5.516049 0.4943244   0 1.740 1.2780 0.0006700762</span></a>
<a class="sourceLine" id="cb14-37" data-line-number="37"><span class="co">#&gt; 3     15    1 132     1 7.108642 0.4676134   0 1.543 1.4592 0.0003405273</span></a>
<a class="sourceLine" id="cb14-38" data-line-number="38"><span class="co">#&gt; 4     15    1 134     1 6.839506 0.4265403   0 1.517 1.6068 0.0005222419</span></a>
<a class="sourceLine" id="cb14-39" data-line-number="39"><span class="co">#&gt; 5     15    1 136     1 8.928395 0.4524887   0 1.352 1.6458 0.0004424231</span></a>
<a class="sourceLine" id="cb14-40" data-line-number="40"><span class="co">#&gt; 6     19    1 138     1 7.153086 0.4508706   0 1.552 1.6224 0.0027560592</span></a>
<a class="sourceLine" id="cb14-41" data-line-number="41"><span class="co">#&gt;   company1 company2 company3 company4 company5 company6 company7 company8</span></a>
<a class="sourceLine" id="cb14-42" data-line-number="42"><span class="co">#&gt; 1        0        0        0        0        0        0        0        0</span></a>
<a class="sourceLine" id="cb14-43" data-line-number="43"><span class="co">#&gt; 2        0        0        0        0        0        0        0        0</span></a>
<a class="sourceLine" id="cb14-44" data-line-number="44"><span class="co">#&gt; 3        0        0        0        0        0        0        0        0</span></a>
<a class="sourceLine" id="cb14-45" data-line-number="45"><span class="co">#&gt; 4        0        0        0        0        0        0        0        0</span></a>
<a class="sourceLine" id="cb14-46" data-line-number="46"><span class="co">#&gt; 5        0        0        0        0        0        0        0        0</span></a>
<a class="sourceLine" id="cb14-47" data-line-number="47"><span class="co">#&gt; 6        0        0        0        0        0        0        0        0</span></a>
<a class="sourceLine" id="cb14-48" data-line-number="48"><span class="co">#&gt;   company9 company10 company11 company12 company13 company14 company15</span></a>
<a class="sourceLine" id="cb14-49" data-line-number="49"><span class="co">#&gt; 1        0         0         0         0         0         0         1</span></a>
<a class="sourceLine" id="cb14-50" data-line-number="50"><span class="co">#&gt; 2        0         0         0         0         0         0         1</span></a>
<a class="sourceLine" id="cb14-51" data-line-number="51"><span class="co">#&gt; 3        0         0         0         0         0         0         1</span></a>
<a class="sourceLine" id="cb14-52" data-line-number="52"><span class="co">#&gt; 4        0         0         0         0         0         0         1</span></a>
<a class="sourceLine" id="cb14-53" data-line-number="53"><span class="co">#&gt; 5        0         0         0         0         0         0         1</span></a>
<a class="sourceLine" id="cb14-54" data-line-number="54"><span class="co">#&gt; 6        0         0         0         0         0         0         0</span></a>
<a class="sourceLine" id="cb14-55" data-line-number="55"><span class="co">#&gt;   company16 company17 company18 company19 company20 company21 company22</span></a>
<a class="sourceLine" id="cb14-56" data-line-number="56"><span class="co">#&gt; 1         0         0         0         0         0         0         0</span></a>
<a class="sourceLine" id="cb14-57" data-line-number="57"><span class="co">#&gt; 2         0         0         0         0         0         0         0</span></a>
<a class="sourceLine" id="cb14-58" data-line-number="58"><span class="co">#&gt; 3         0         0         0         0         0         0         0</span></a>
<a class="sourceLine" id="cb14-59" data-line-number="59"><span class="co">#&gt; 4         0         0         0         0         0         0         0</span></a>
<a class="sourceLine" id="cb14-60" data-line-number="60"><span class="co">#&gt; 5         0         0         0         0         0         0         0</span></a>
<a class="sourceLine" id="cb14-61" data-line-number="61"><span class="co">#&gt; 6         0         0         0         1         0         0         0</span></a>
<a class="sourceLine" id="cb14-62" data-line-number="62"><span class="co">#&gt;   company23 company24 company25 company26 IV1       IV2 IV3    IV4     IV5</span></a>
<a class="sourceLine" id="cb14-63" data-line-number="63"><span class="co">#&gt; 1         0         0         0         0   4  1.840967   0  6.152  5.9898</span></a>
<a class="sourceLine" id="cb14-64" data-line-number="64"><span class="co">#&gt; 2         0         0         0         0   4  1.875639   0  6.109  5.8620</span></a>
<a class="sourceLine" id="cb14-65" data-line-number="65"><span class="co">#&gt; 3         0         0         0         0   4  1.902350   0  6.306  5.6808</span></a>
<a class="sourceLine" id="cb14-66" data-line-number="66"><span class="co">#&gt; 4         0         0         0         0   4  1.943423   0  6.332  5.5332</span></a>
<a class="sourceLine" id="cb14-67" data-line-number="67"><span class="co">#&gt; 5         0         0         0         0   4  1.917475   0  6.497  5.4942</span></a>
<a class="sourceLine" id="cb14-68" data-line-number="68"><span class="co">#&gt; 6         0         0         0         0  28 16.964809   0 44.328 46.1233</span></a>
<a class="sourceLine" id="cb14-69" data-line-number="69"><span class="co">#&gt;   IV6      IV7 IV8     IV9     IV10</span></a>
<a class="sourceLine" id="cb14-70" data-line-number="70"><span class="co">#&gt; 1  87 44.55554   0 150.386 125.5613</span></a>
<a class="sourceLine" id="cb14-71" data-line-number="71"><span class="co">#&gt; 2  87 44.55554   0 150.386 125.5613</span></a>
<a class="sourceLine" id="cb14-72" data-line-number="72"><span class="co">#&gt; 3  87 44.55554   0 150.386 125.5613</span></a>
<a class="sourceLine" id="cb14-73" data-line-number="73"><span class="co">#&gt; 4  87 44.55554   0 150.386 125.5613</span></a>
<a class="sourceLine" id="cb14-74" data-line-number="74"><span class="co">#&gt; 5  87 44.55554   0 150.386 125.5613</span></a>
<a class="sourceLine" id="cb14-75" data-line-number="75"><span class="co">#&gt; 6  63 29.50982   0 112.355  84.9556</span></a>
<a class="sourceLine" id="cb14-76" data-line-number="76"></a>
<a class="sourceLine" id="cb14-77" data-line-number="77"><span class="co"># To show similarities between implementations of other authors,</span></a>
<a class="sourceLine" id="cb14-78" data-line-number="78"><span class="co"># the variable &quot;const&quot; is used, although constants are considered by default.</span></a>
<a class="sourceLine" id="cb14-79" data-line-number="79">blps_model &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="st">&quot;share ~  0 + const + price + hpwt + air + mpg + space |</span></a>
<a class="sourceLine" id="cb14-80" data-line-number="80"><span class="st">                        0 + const + hpwt + air + mpg + space |</span></a>
<a class="sourceLine" id="cb14-81" data-line-number="81"><span class="st">                        0 + price + const + hpwt + air + mpg |</span></a>
<a class="sourceLine" id="cb14-82" data-line-number="82"><span class="st">                        0 + IV1 + IV2 + IV3 + IV4 + IV5 + IV6 + IV7 + IV8 + IV9 + IV10&quot;</span>)</a>
<a class="sourceLine" id="cb14-83" data-line-number="83"></a>
<a class="sourceLine" id="cb14-84" data-line-number="84">car_data &lt;-<span class="st"> </span><span class="kw">BLP_data</span>(</a>
<a class="sourceLine" id="cb14-85" data-line-number="85">  <span class="dt">model =</span> blps_model,</a>
<a class="sourceLine" id="cb14-86" data-line-number="86">  <span class="dt">market_identifier =</span> <span class="st">&quot;cdid&quot;</span>,</a>
<a class="sourceLine" id="cb14-87" data-line-number="87">  <span class="dt">product_identifier =</span> <span class="st">&quot;id&quot;</span>,</a>
<a class="sourceLine" id="cb14-88" data-line-number="88">  <span class="dt">additional_variables =</span> <span class="kw">paste0</span>(<span class="st">&quot;company&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">26</span>), <span class="co"># check reordering works</span></a>
<a class="sourceLine" id="cb14-89" data-line-number="89">  <span class="dt">productData =</span> productData_cars,</a>
<a class="sourceLine" id="cb14-90" data-line-number="90">  <span class="dt">blp_inner_tol =</span> <span class="fl">1e-9</span>,</a>
<a class="sourceLine" id="cb14-91" data-line-number="91">  <span class="dt">blp_inner_maxit =</span> <span class="dv">5000</span>,</a>
<a class="sourceLine" id="cb14-92" data-line-number="92">  <span class="dt">integration_method =</span> <span class="st">&quot;MLHS&quot;</span>,</a>
<a class="sourceLine" id="cb14-93" data-line-number="93">  <span class="dt">integration_accuracy =</span> <span class="dv">50</span>, <span class="dt">integration_seed =</span> <span class="dv">48</span></a>
<a class="sourceLine" id="cb14-94" data-line-number="94">)</a>
<a class="sourceLine" id="cb14-95" data-line-number="95"><span class="co">#&gt; Mean utility (variable name: `delta`) is initialized with 0 because of missing or invalid par_delta argument.</span></a></code></pre></div>
<p>In the next step, starting guesses for random coefficients are generated from a standard normal distribution. The estimation of the model works like before.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">121</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">theta_guesses &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw">rownames</span>(theta_guesses) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;price&quot;</span>, <span class="st">&quot;const&quot;</span>, <span class="st">&quot;hpwt&quot;</span>, <span class="st">&quot;air&quot;</span>, <span class="st">&quot;mpg&quot;</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="kw">colnames</span>(theta_guesses) &lt;-<span class="st"> &quot;unobs_sd&quot;</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">car_est &lt;-<span class="st"> </span><span class="kw">estimateBLP</span>(</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  <span class="dt">blp_data =</span> car_data,</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">  <span class="dt">par_theta2 =</span> theta_guesses,</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">  <span class="dt">solver_method =</span> <span class="st">&quot;BFGS&quot;</span>, <span class="dt">solver_maxit =</span> <span class="dv">1000</span>, <span class="dt">solver_reltol =</span> <span class="fl">1e-6</span>,</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">  <span class="dt">extremumCheck =</span> <span class="ot">FALSE</span>, <span class="dt">printLevel =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt; blp_data were prepared with the following arguments:</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt; BLP_data(model = blps_model, market_identifier = &quot;cdid&quot;, product_identifier = &quot;id&quot;, </span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt;     additional_variables = paste0(&quot;company&quot;, 1:26), productData = productData_cars, </span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt;     integration_accuracy = 50, integration_method = &quot;MLHS&quot;, integration_seed = 48, </span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt;     blp_inner_tol = 1e-09, blp_inner_maxit = 5000)</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt; ------------------------------------------ </span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt; Solver message: Successful convergence </span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co">#&gt; ------------------------------------------ </span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="co">#&gt; Final GMM evaluation at optimal parameters: </span></a>
<a class="sourceLine" id="cb15-22" data-line-number="22"><span class="co">#&gt; gmm objective: 131.2733</span></a>
<a class="sourceLine" id="cb15-23" data-line-number="23"><span class="co">#&gt;   theta (RC): -0.42 -8.59 1.27 -0.1 1.07 </span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24"><span class="co">#&gt;   theta (demogr.):  </span></a>
<a class="sourceLine" id="cb15-25" data-line-number="25"><span class="co">#&gt;   inner iterations: 67 </span></a>
<a class="sourceLine" id="cb15-26" data-line-number="26"><span class="co">#&gt;   gradient: -18.916 3.6499 27.2623 -8.5398 -28.9531 </span></a>
<a class="sourceLine" id="cb15-27" data-line-number="27"><span class="co">#&gt; Using the heteroskedastic asymptotic variance-covariance matrix...</span></a>
<a class="sourceLine" id="cb15-28" data-line-number="28"></a>
<a class="sourceLine" id="cb15-29" data-line-number="29"><span class="kw">summary</span>(car_est)</a>
<a class="sourceLine" id="cb15-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-31" data-line-number="31"><span class="co">#&gt; Data information:</span></a>
<a class="sourceLine" id="cb15-32" data-line-number="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-33" data-line-number="33"><span class="co">#&gt;   20 market(s) with 2217 products </span></a>
<a class="sourceLine" id="cb15-34" data-line-number="34"><span class="co">#&gt;   6 linear coefficient(s) (5 exogenous coefficients) </span></a>
<a class="sourceLine" id="cb15-35" data-line-number="35"><span class="co">#&gt;   5 non-linear parameters related to random coefficients </span></a>
<a class="sourceLine" id="cb15-36" data-line-number="36"><span class="co">#&gt;   0 demographic variable(s) </span></a>
<a class="sourceLine" id="cb15-37" data-line-number="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-38" data-line-number="38"><span class="co">#&gt; Estimation results:</span></a>
<a class="sourceLine" id="cb15-39" data-line-number="39"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-40" data-line-number="40"><span class="co">#&gt;  Linear Coefficients</span></a>
<a class="sourceLine" id="cb15-41" data-line-number="41"><span class="co">#&gt;          Estimate Std. Error    t value     Pr(&gt;|t|)</span></a>
<a class="sourceLine" id="cb15-42" data-line-number="42"><span class="co">#&gt; const -13.0980731  1.0748672 -12.185759 3.701895e-34</span></a>
<a class="sourceLine" id="cb15-43" data-line-number="43"><span class="co">#&gt; price  -0.9049313  0.1609564  -5.622213 1.885269e-08</span></a>
<a class="sourceLine" id="cb15-44" data-line-number="44"><span class="co">#&gt; hpwt    2.1752674  0.8598893   2.529706 1.141581e-02</span></a>
<a class="sourceLine" id="cb15-45" data-line-number="45"><span class="co">#&gt; air     1.4011076  0.2567444   5.457207 4.836817e-08</span></a>
<a class="sourceLine" id="cb15-46" data-line-number="46"><span class="co">#&gt; mpg    -0.7994763  0.6366915  -1.255673 2.092345e-01</span></a>
<a class="sourceLine" id="cb15-47" data-line-number="47"><span class="co">#&gt; space   3.1465811  0.3542019   8.883580 6.474222e-19</span></a>
<a class="sourceLine" id="cb15-48" data-line-number="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-49" data-line-number="49"><span class="co">#&gt;  Random Coefficients</span></a>
<a class="sourceLine" id="cb15-50" data-line-number="50"><span class="co">#&gt;                  Estimate Std. Error    t value     Pr(&gt;|t|)</span></a>
<a class="sourceLine" id="cb15-51" data-line-number="51"><span class="co">#&gt; unobs_sd*price -0.4150985 0.08593854 -4.8301784 1.364108e-06</span></a>
<a class="sourceLine" id="cb15-52" data-line-number="52"><span class="co">#&gt; unobs_sd*const -8.5907908 2.19917403 -3.9063715 9.369243e-05</span></a>
<a class="sourceLine" id="cb15-53" data-line-number="53"><span class="co">#&gt; unobs_sd*hpwt   1.2712851 0.41076258  3.0949390 1.968534e-03</span></a>
<a class="sourceLine" id="cb15-54" data-line-number="54"><span class="co">#&gt; unobs_sd*air   -0.1005375 0.67001283 -0.1500531 8.807227e-01</span></a>
<a class="sourceLine" id="cb15-55" data-line-number="55"><span class="co">#&gt; unobs_sd*mpg    1.0652496 0.48637023  2.1902032 2.850950e-02</span></a>
<a class="sourceLine" id="cb15-56" data-line-number="56"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-57" data-line-number="57"><span class="co">#&gt;  Wald Test</span></a>
<a class="sourceLine" id="cb15-58" data-line-number="58"><span class="co">#&gt; 45.1733 on  5 DF, p-value: 1.33780388852691e-08 </span></a>
<a class="sourceLine" id="cb15-59" data-line-number="59"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb15-60" data-line-number="60"><span class="co">#&gt; Computational Details: </span></a>
<a class="sourceLine" id="cb15-61" data-line-number="61"><span class="co">#&gt;   Solver converged with 187 iterations to a minimum at 131.2733 .</span></a>
<a class="sourceLine" id="cb15-62" data-line-number="62"><span class="co">#&gt;   Local minima check: NA</span></a>
<a class="sourceLine" id="cb15-63" data-line-number="63"><span class="co">#&gt;   stopping criterion outer loop: 1e-06</span></a>
<a class="sourceLine" id="cb15-64" data-line-number="64"><span class="co">#&gt;   stopping criterion inner loop: 1e-09</span></a>
<a class="sourceLine" id="cb15-65" data-line-number="65"><span class="co">#&gt;   Market shares are integrated with MLHS and 50 draws. </span></a>
<a class="sourceLine" id="cb15-66" data-line-number="66"><span class="co">#&gt;   Method for standard errors: heteroskedastic</span></a></code></pre></div>
<p>Next, all parameters that are required by the subsequent merger analysis are extracted. Note that all extracted data is based on the estimation object <code>car_est</code> or the data object <code>car_data</code> to maintain data consistency (for example, the order of data in <code>product_data_cars</code> might differ from <code>car_data</code>). Moreover, mean utilities are updated in <code>car_data</code> by the values in the estimation object <code>car_est</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">## Pre-Merger data</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">own_pre &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(car_data<span class="op">$</span>data<span class="op">$</span>additional_data[, <span class="kw">paste0</span>(<span class="st">&quot;company&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">26</span>)])</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">delta_pre &lt;-<span class="st"> </span>car_est<span class="op">$</span>delta</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">theta1_price &lt;-<span class="st"> </span>car_est<span class="op">$</span>theta_lin[<span class="st">&quot;price&quot;</span>, ]</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">theta2_price &lt;-<span class="st"> </span>car_est<span class="op">$</span>theta_rc[<span class="st">&quot;unobs_sd*price&quot;</span>]</a>
<a class="sourceLine" id="cb16-6" data-line-number="6">theta2_all &lt;-<span class="st"> </span><span class="kw">matrix</span>(car_est<span class="op">$</span>theta_rc)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="kw">rownames</span>(theta2_all) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;price&quot;</span>, <span class="st">&quot;const&quot;</span>, <span class="st">&quot;hpwt&quot;</span>, <span class="st">&quot;air&quot;</span>, <span class="st">&quot;mpg&quot;</span>)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="kw">colnames</span>(theta2_all) &lt;-<span class="st"> &quot;unobs_sd&quot;</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">## update mean utility in data ( always use update_BLP_data() to update data object to maintain consistent data )</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">delta_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb16-12" data-line-number="12">  <span class="st">&quot;id&quot;</span> =<span class="st"> </span>car_data<span class="op">$</span>parameters<span class="op">$</span>product_id,</a>
<a class="sourceLine" id="cb16-13" data-line-number="13">  <span class="st">&quot;cdid&quot;</span> =<span class="st"> </span>car_data<span class="op">$</span>parameters<span class="op">$</span>market_id,</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">  <span class="st">&quot;delta&quot;</span> =<span class="st"> </span>delta_pre</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">car_data_updated &lt;-<span class="st"> </span><span class="kw">update_BLP_data</span>(</a>
<a class="sourceLine" id="cb16-17" data-line-number="17">  <span class="dt">data_update =</span> delta_data,</a>
<a class="sourceLine" id="cb16-18" data-line-number="18">  <span class="dt">blp_data =</span> car_data</a>
<a class="sourceLine" id="cb16-19" data-line-number="19">)</a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co">#&gt; Mean utility variable delta has been updated.</span></a></code></pre></div>
<p>In the next step, an estimate for marginal costs <span class="math inline">\(mc\)</span> <strong>before</strong> the merger is computed. The following is based on the FOC of a Bertrand equilibrium with prices <span class="math inline">\(p\)</span> before the merger:</p>
<p><span class="math display">\[ p^{pre} - \widehat{mc} = \Omega^{pre}(p^{pre})^{-1} \hat{s}(p^{pre}) \]</span> <span class="math inline">\(\Omega^{pre}(p^{pre})^{-1}\)</span> is defined marketwise as the inverse of</p>
<p><span class="math display">\[ \Omega^{pre}(p^{pre}) = 
\pmatrix{
-\frac{\partial s_{1}}{\partial p_{1}} (p^{pre}) \cdot D_{1,1}  &amp; -\frac{\partial s_{2}}{\partial p_{1}} (p^{pre}) \cdot D_{1,2} &amp; \cdots &amp;  -\frac{\partial s_{j}}{\partial p_{1}} (p^{pre}) \cdot D_{1,j} &amp; \cdots &amp; -\frac{\partial s_{J}}{\partial p_{1}} (p^{pre}) \cdot D_{1,J}\\
-\frac{\partial s_{1}}{\partial p_{2}} (p^{pre}) \cdot  D_{2,1} &amp; -\frac{\partial s_{2}}{\partial p_{2}} (p^{pre}) \cdot  D_{2,2} &amp; \cdots &amp; -\frac{\partial s_{j}}{\partial p_{2}} (p^{pre}) \cdot D_{2,j} &amp; \cdots &amp; -\frac{\partial s_{J}}{\partial p_{2}} (p^{pre}) \cdot  D_{2,J}\\
\vdots  &amp; \vdots  &amp; \ddots &amp;   \vdots     &amp;  \ddots      &amp; \vdots\\
-\frac{\partial s_{1}}{\partial p_{k}} (p^{pre}) \cdot D_{k,1}  &amp; -\frac{\partial s_{2}}{\partial p_{k}} (p^{pre}) \cdot D_{k,2}  &amp; \cdots &amp; -\frac{\partial s_{j}}{\partial p_{k}} (p^{pre}) \cdot D_{k,j}  &amp;  \cdots &amp;
-\frac{\partial s_{J}}{\partial p_{k}} (p^{pre}) \cdot D_{k,J}\\
\vdots  &amp; \vdots  &amp; \ddots &amp;   \vdots     &amp;    \ddots    &amp; \vdots\\
-\frac{\partial s_{1}}{\partial p_{J}} (p^{pre}) \cdot  D_{J,1} &amp; -\frac{\partial s_{2}}{\partial p_{J}} (p^{pre}) \cdot  D_{J,2} &amp; \cdots &amp; -\frac{\partial s_{j}}{\partial p_{J}} (p^{pre}) \cdot  D_{J,j}&amp; \cdots &amp; -\frac{\partial s_{J}}{\partial p_{J}} (p^{pre}) \cdot  D_{J,J}\\
} 
 \]</span></p>
<p>with <span class="math display">\[D_{k,j} = 
\begin{cases} 
1 &amp; \text{if products k and j are produced by the same firm} \\
0 &amp; \text{otherwise} \\
\end{cases}\]</span></p>
<p>Partial derivatives <span class="math inline">\(\frac{\partial s_j}{\partial p_k}\)</span> can be calculated based on the elasticity <span class="math inline">\(\eta_{jk} = \frac{\partial s_j }{\partial p_k }\frac{ p_k}{ s_j}\)</span>, so <span class="math display">\[ \frac{\partial s_j}{\partial p_k} = \eta_{jk} \cdot \frac{ s_j}{ p_k} \]</span></p>
<p>In the following code chunk, these objects in a market <code>i</code> are labeled as follows:</p>
<ul>
<li><code>own_prod_pre_i</code> (<span class="math inline">\(D_{k,j}\)</span>)</li>
<li><code>elasticities_i</code> (<span class="math inline">\(\eta_{jk}\)</span>)</li>
<li><code>derivatives_i</code> (<span class="math inline">\(\eta_{jk} \cdot \frac{ s_j}{ p_k}\)</span>)</li>
<li><code>-solve(t(derivatives_i) * own_prod_pre_i)</code> (<span class="math inline">\(\Omega^{pre}(p^{pre})^{-1}\)</span>)</li>
<li><code>shareObj$shares</code> (<span class="math inline">\(\hat{s}(p^{pre})\)</span>).</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">## calculate sij</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">shareObj &lt;-<span class="st"> </span><span class="kw">getShareInfo</span>(</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="dt">blp_data =</span> car_data_updated,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  <span class="dt">par_theta2 =</span> theta2_all,</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  <span class="dt">printLevel =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="co">## computation of marginal costs</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">market_id &lt;-<span class="st"> </span>car_data<span class="op">$</span>parameters<span class="op">$</span>market_id</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">nmkt &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(market_id))</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">markups &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(market_id))</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"></a>
<a class="sourceLine" id="cb17-13" data-line-number="13">sh &lt;-<span class="st"> </span>shareObj<span class="op">$</span>shares</a>
<a class="sourceLine" id="cb17-14" data-line-number="14">prices_pre &lt;-<span class="st"> </span>car_data<span class="op">$</span>data<span class="op">$</span>X_rand[, <span class="st">&quot;price&quot;</span>]</a>
<a class="sourceLine" id="cb17-15" data-line-number="15"></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"></a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nmkt) {</a>
<a class="sourceLine" id="cb17-18" data-line-number="18">  mkt_ind &lt;-<span class="st"> </span>market_id <span class="op">==</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb17-19" data-line-number="19">  share_i &lt;-<span class="st"> </span>sh[ mkt_ind ]</a>
<a class="sourceLine" id="cb17-20" data-line-number="20">  price_pre_i &lt;-<span class="st"> </span>prices_pre[ mkt_ind ]</a>
<a class="sourceLine" id="cb17-21" data-line-number="21">  scalar_i &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>share_i) <span class="op">%*%</span><span class="st"> </span><span class="kw">matrix</span>(price_pre_i, <span class="dt">nrow =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-22" data-line-number="22">  elasticities_i &lt;-<span class="st"> </span><span class="kw">get_elasticities</span>(</a>
<a class="sourceLine" id="cb17-23" data-line-number="23">    <span class="dt">blp_data =</span> car_data_updated,</a>
<a class="sourceLine" id="cb17-24" data-line-number="24">    <span class="dt">share_info =</span> shareObj,</a>
<a class="sourceLine" id="cb17-25" data-line-number="25">    <span class="dt">theta_lin =</span> theta1_price,</a>
<a class="sourceLine" id="cb17-26" data-line-number="26">    <span class="dt">variable =</span> <span class="st">&quot;price&quot;</span>,</a>
<a class="sourceLine" id="cb17-27" data-line-number="27">    <span class="dt">market =</span> i,</a>
<a class="sourceLine" id="cb17-28" data-line-number="28">    <span class="dt">printLevel =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb17-29" data-line-number="29">  )</a>
<a class="sourceLine" id="cb17-30" data-line-number="30"></a>
<a class="sourceLine" id="cb17-31" data-line-number="31">  derivatives_i &lt;-<span class="st"> </span>elasticities_i <span class="op">/</span><span class="st"> </span>scalar_i <span class="co"># partial derivatives of shares wrt price</span></a>
<a class="sourceLine" id="cb17-32" data-line-number="32">  own_pre_i &lt;-<span class="st"> </span>own_pre[ mkt_ind, ]</a>
<a class="sourceLine" id="cb17-33" data-line-number="33">  own_prod_pre_i &lt;-<span class="st"> </span>own_pre_i <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(own_pre_i) <span class="co"># if element (i,j) equals 1, that means that prod i and j are produced by same firm</span></a>
<a class="sourceLine" id="cb17-34" data-line-number="34">  markups[mkt_ind] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="kw">solve</span>(<span class="kw">t</span>(derivatives_i) <span class="op">*</span><span class="st"> </span>own_prod_pre_i) <span class="op">%*%</span><span class="st"> </span>share_i)</a>
<a class="sourceLine" id="cb17-35" data-line-number="35">}</a>
<a class="sourceLine" id="cb17-36" data-line-number="36">marg_cost &lt;-<span class="st"> </span>prices_pre <span class="op">-</span><span class="st"> </span>markups</a></code></pre></div>
<p>The ownership matrix is adjusted to implement a hypothetical merger between Chrysler and GM:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Merger between company 16 and 19 (i.e. GM and Chrysler)</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">prices_post &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="dv">2217</span>)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">own_post &lt;-<span class="st"> </span><span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  own_pre[, <span class="dv">1</span><span class="op">:</span><span class="dv">15</span>],</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">  own_pre[, <span class="dv">16</span>] <span class="op">+</span><span class="st"> </span>own_pre[, <span class="dv">19</span>],</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">  own_pre[, <span class="dv">17</span><span class="op">:</span><span class="dv">18</span>],</a>
<a class="sourceLine" id="cb18-7" data-line-number="7">  own_pre[, <span class="dv">20</span><span class="op">:</span><span class="dv">26</span>]</a>
<a class="sourceLine" id="cb18-8" data-line-number="8">)</a></code></pre></div>
<p>To analyze the effect on prices the FOC of the new equilibrium must be solved: <span class="math display">\[ p^{post} - \widehat{mc} = \Omega^{post}(p^{post})^{-1} \hat{s}(p^{post}) \]</span></p>
<p>The solution of this set of non-linear equations is obtained by the function <code>foc_bertrand_mkt</code> and the package <code>nleqslv</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">foc_bertrand_mkt &lt;-<span class="st"> </span><span class="cf">function</span>(par, own_prod, blp_data, mkt, marg_cost, theta_lin, theta_rc) {</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">  <span class="co"># argument par: candidate for post merger prices</span></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">  <span class="co"># arguments own_prod, blp_data, mkt, marg_cost, theta_lin, theta_rc: see previous code blocks</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">  <span class="co"># post merger updates: update the BLP_data object for market i</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  tmp &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">    <span class="st">&quot;id&quot;</span> =<span class="st"> </span>blp_data<span class="op">$</span>parameters<span class="op">$</span>product_id,</a>
<a class="sourceLine" id="cb19-8" data-line-number="8">    <span class="st">&quot;cdid&quot;</span> =<span class="st"> </span>blp_data<span class="op">$</span>parameters<span class="op">$</span>market_id,</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">    <span class="st">&quot;delta&quot;</span> =<span class="st"> </span>blp_data<span class="op">$</span>data<span class="op">$</span>delta,</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">    <span class="st">&quot;price&quot;</span> =<span class="st"> </span>blp_data<span class="op">$</span>data<span class="op">$</span>X_rand[, <span class="st">&quot;price&quot;</span>]</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">  )</a>
<a class="sourceLine" id="cb19-12" data-line-number="12"></a>
<a class="sourceLine" id="cb19-13" data-line-number="13">  market_ind &lt;-<span class="st"> </span>blp_data<span class="op">$</span>parameters<span class="op">$</span>market_id <span class="op">==</span><span class="st"> </span>mkt</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">  delta_old &lt;-<span class="st"> </span>blp_data<span class="op">$</span>data<span class="op">$</span>delta</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">  prices_pre &lt;-<span class="st"> </span>blp_data<span class="op">$</span>data<span class="op">$</span>X_rand[, <span class="st">&quot;price&quot;</span>]</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">  tmp<span class="op">$</span>price[ market_ind ] &lt;-<span class="st"> </span>par</a>
<a class="sourceLine" id="cb19-17" data-line-number="17">  tmp<span class="op">$</span>delta[ market_ind ] &lt;-<span class="st"> </span>delta_old[market_ind] <span class="op">-</span><span class="st"> </span>prices_pre[market_ind] <span class="op">*</span><span class="st"> </span>theta_lin <span class="op">+</span><span class="st"> </span>par <span class="op">*</span><span class="st"> </span>theta_lin</a>
<a class="sourceLine" id="cb19-18" data-line-number="18"></a>
<a class="sourceLine" id="cb19-19" data-line-number="19"></a>
<a class="sourceLine" id="cb19-20" data-line-number="20">  new_blp_data &lt;-<span class="st"> </span><span class="kw">update_BLP_data</span>(</a>
<a class="sourceLine" id="cb19-21" data-line-number="21">    <span class="dt">blp_data =</span> blp_data,</a>
<a class="sourceLine" id="cb19-22" data-line-number="22">    <span class="dt">data_update =</span> tmp</a>
<a class="sourceLine" id="cb19-23" data-line-number="23">  )</a>
<a class="sourceLine" id="cb19-24" data-line-number="24"></a>
<a class="sourceLine" id="cb19-25" data-line-number="25">  ShareObj &lt;-<span class="st"> </span><span class="kw">getShareInfo</span>(</a>
<a class="sourceLine" id="cb19-26" data-line-number="26">    <span class="dt">blp_data =</span> new_blp_data,</a>
<a class="sourceLine" id="cb19-27" data-line-number="27">    <span class="dt">par_theta2 =</span> theta_rc,</a>
<a class="sourceLine" id="cb19-28" data-line-number="28">    <span class="dt">printLevel =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb19-29" data-line-number="29">  )</a>
<a class="sourceLine" id="cb19-30" data-line-number="30"></a>
<a class="sourceLine" id="cb19-31" data-line-number="31">  implied_shares &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(ShareObj<span class="op">$</span>shares[market_ind])</a>
<a class="sourceLine" id="cb19-32" data-line-number="32"></a>
<a class="sourceLine" id="cb19-33" data-line-number="33">  elasticities_post_mkt &lt;-<span class="st"> </span><span class="kw">get_elasticities</span>(</a>
<a class="sourceLine" id="cb19-34" data-line-number="34">    <span class="dt">blp_data =</span> new_blp_data,</a>
<a class="sourceLine" id="cb19-35" data-line-number="35">    <span class="dt">share_info =</span> ShareObj,</a>
<a class="sourceLine" id="cb19-36" data-line-number="36">    <span class="dt">theta_lin =</span> theta_lin,</a>
<a class="sourceLine" id="cb19-37" data-line-number="37">    <span class="dt">variable =</span> <span class="st">&quot;price&quot;</span>,</a>
<a class="sourceLine" id="cb19-38" data-line-number="38">    <span class="dt">market =</span> mkt,</a>
<a class="sourceLine" id="cb19-39" data-line-number="39">    <span class="dt">printLevel =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb19-40" data-line-number="40">  )</a>
<a class="sourceLine" id="cb19-41" data-line-number="41"></a>
<a class="sourceLine" id="cb19-42" data-line-number="42">  scalar_mkt &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>implied_shares) <span class="op">%*%</span><span class="st"> </span><span class="kw">matrix</span>(par, <span class="dt">nrow =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb19-43" data-line-number="43">  derivatives_mkt &lt;-<span class="st"> </span>elasticities_post_mkt <span class="op">/</span><span class="st"> </span>scalar_mkt</a>
<a class="sourceLine" id="cb19-44" data-line-number="44"></a>
<a class="sourceLine" id="cb19-45" data-line-number="45">  markups_post &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="kw">solve</span>(<span class="kw">t</span>(derivatives_mkt) <span class="op">*</span><span class="st"> </span>own_prod) <span class="op">%*%</span><span class="st"> </span>implied_shares)</a>
<a class="sourceLine" id="cb19-46" data-line-number="46">  differences &lt;-<span class="st"> </span>par <span class="op">-</span><span class="st"> </span>marg_cost[market_ind] <span class="op">-</span><span class="st"> </span>markups_post</a>
<a class="sourceLine" id="cb19-47" data-line-number="47"></a>
<a class="sourceLine" id="cb19-48" data-line-number="48">  <span class="kw">return</span>(differences)</a>
<a class="sourceLine" id="cb19-49" data-line-number="49">}</a></code></pre></div>
<p>Finally, the function is used to compute the new equilibrium:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">library</span>(nleqslv) <span class="co"># to solve non linear first order conditions</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nmkt) {</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  mkt_ind &lt;-<span class="st"> </span>market_id <span class="op">==</span><span class="st"> </span>i</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  own_post_i &lt;-<span class="st"> </span>own_post[ mkt_ind, ]</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">  own_prod_post_i &lt;-<span class="st"> </span>own_post_i <span class="op">%*%</span><span class="st"> </span><span class="kw">t</span>(own_post_i)</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">  price_pre_i &lt;-<span class="st"> </span>prices_pre[ mkt_ind ]</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"></a>
<a class="sourceLine" id="cb20-8" data-line-number="8">  solution &lt;-<span class="st"> </span><span class="kw">nleqslv</span>(</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">    <span class="dt">x =</span> price_pre_i, foc_bertrand_mkt, <span class="co"># startingguesses: price_pre_i</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10">    <span class="dt">own_prod =</span> own_prod_post_i,</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">    <span class="dt">blp_data =</span> car_data_updated,</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">    <span class="dt">mkt =</span> i,</a>
<a class="sourceLine" id="cb20-13" data-line-number="13">    <span class="dt">marg_cost =</span> marg_cost,</a>
<a class="sourceLine" id="cb20-14" data-line-number="14">    <span class="dt">theta_lin =</span> theta1_price,</a>
<a class="sourceLine" id="cb20-15" data-line-number="15">    <span class="dt">theta_rc =</span> theta2_all</a>
<a class="sourceLine" id="cb20-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb20-17" data-line-number="17"></a>
<a class="sourceLine" id="cb20-18" data-line-number="18">  prices_post[ market_id <span class="op">==</span><span class="st"> </span>i ] &lt;-<span class="st"> </span>solution<span class="op">$</span>x</a>
<a class="sourceLine" id="cb20-19" data-line-number="19">}</a></code></pre></div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-BLP1995">
<p>Berry, Steven, James Levinsohn, and Ariel Pakes. 1995. “Automobile Prices in Market Equilibrium.” <em>Econometrica</em>.</p>
</div>
<div id="ref-Brunner2017">
<p>Brunner, Daniel, Florian Heiss, Andre Romahn, and Constantin Weiser. 2017. “Reliable Estimation of Random Coefficient Logit Demand Models.” <em>DICE Discussion Paper No 267</em>.</p>
</div>
<div id="ref-KM2014">
<p>Knittel, Christopher, and Konstantinos Metaxoglou. 2014. “Estimation of Random-Coefficient Demand Models: Two Empiricists Perspective.” <em>The Review of Economics and Statistics</em>.</p>
</div>
<div id="ref-Nevo2001">
<p>Nevo, Aviv. 2001. “A Practitioner’s Guide to Estimation of Random-Coefficients Logit Models of Demand.” <em>Journal of Economics &amp; Management Strategy</em>.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
